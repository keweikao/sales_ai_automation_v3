# å¤šç”¢å“ç·šæ”¯æ´å¯¦ä½œè¨ˆç•«ï¼šé¤é£² (iCHEF) + ç¾æ¥­

## åŸ·è¡Œæ‘˜è¦

å°‡ç¾æœ‰çš„ iCHEF é¤é£² POS éŠ·å”®åˆ†æç³»çµ±æ“´å±•ç‚ºæ”¯æ´å¤šç”¢å“ç·šæ¶æ§‹ï¼Œé¦–å…ˆæ”¯æ´ç¾æ¥­ç”¢å“ç·šã€‚æ¡ç”¨é…ç½®é©…å‹•ã€å‘å¾Œç›¸å®¹çš„è¨­è¨ˆï¼Œç¢ºä¿æœªä¾†å¯è¼•é¬†æ“´å±•åˆ°æ›´å¤šç”¢å“ç·šã€‚

**æ ¸å¿ƒè¨­è¨ˆåŸå‰‡**ï¼š
1. **é…ç½®é©…å‹•** - æ‰€æœ‰ç”¢å“ç·šç‰¹å®šé‚è¼¯å¾ä¸­å¤®é…ç½®è®€å–
2. **å‘å¾Œç›¸å®¹** - ä¸ç ´å£ç¾æœ‰ iCHEF åŠŸèƒ½ï¼Œæ‰€æœ‰æ–°æ¬„ä½ä½¿ç”¨é è¨­å€¼
3. **å¯æ“´å±•** - æœªä¾†æ–°å¢ç¬¬ä¸‰å€‹ç”¢å“ç·šåƒ…éœ€ 3-4 å°æ™‚
4. **é—œæ³¨é»åˆ†é›¢** - é€šç”¨é‚è¼¯èˆ‡ç”¢å“ç‰¹å®šé‚è¼¯æ¸…æ™°åˆ†é›¢
5. **ä¸¦è¡Œé–‹ç™¼** - 5 å€‹ç¨ç«‹æ¨¡çµ„å¯ç”±ä¸åŒ Agent åŒæ­¥é–‹ç™¼

**ä½¿ç”¨è€…éœ€æ±‚ç¢ºèª**ï¼š
- âœ… Channel ç­–ç•¥ï¼šç¾æ¥­ä½¿ç”¨ç¨ç«‹ Slack Channelï¼ˆè‡ªå‹•è­˜åˆ¥ç”¢å“ç·šï¼‰
- âœ… è¡¨å–®æ¬„ä½ï¼šç¾æ¥­éœ€è¦åº—é‹ªé¡å‹ã€å“¡å·¥æ•¸é‡ã€ç¾æœ‰ç³»çµ±
- âœ… è³‡æ–™åº«è¨­è¨ˆï¼šå…±ç”¨è¡¨æ ¼ + `product_line` æ¬„ä½å€åˆ†
- âœ… å ±è¡¨ç­–ç•¥ï¼šçµ±ä¸€å„€è¡¨æ¿ + ç”¢å“ç·šç¯©é¸

---

## å¹³è¡Œé–‹ç™¼æ¶æ§‹ï¼ˆ5 å€‹ Agent åŒæ­¥ä½œæ¥­ï¼‰

### æ¨¡çµ„ä¾è³´é—œä¿‚åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Agent A       â”‚  â† åŸºç¤è¨­æ–½ï¼ˆç„¡ä¾è³´ï¼Œå„ªå…ˆé–‹å§‹ï¼‰
â”‚ Config + DB     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ æä¾›ï¼šProductLineConfig interface, DB schema
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Agent B       â”‚ â”‚   Agent C       â”‚ â”‚   Agent D       â”‚
â”‚  Slack Bot      â”‚ â”‚  MEDDIC Prompt  â”‚ â”‚  API + Queue    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Agent E       â”‚
         â”‚  Dashboard      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸¦è¡Œé–‹ç™¼æ™‚ç¨‹è¡¨

| é€±æ¬¡ | Agent A | Agent B | Agent C | Agent D | Agent E |
|-----|---------|---------|---------|---------|---------|
| **W1** | ğŸ”´ Config+DB<br>(8-10h) | ğŸ”´ Slack Bot<br>(8-10h) | ğŸŸ¡ Prompts<br>(4-6h) | - | - |
| **W2** | âœ… å®Œæˆ | âœ… å®Œæˆ | ğŸŸ¡ Loader<br>(6-8h) | ğŸŸ¡ API<br>(4-6h) | - |
| **W3** | - | - | âœ… å®Œæˆ | ğŸŸ¡ Queue<br>(2-4h) | ğŸŸ¢ UI<br>(4-6h) |
| **W4** | - | - | - | âœ… å®Œæˆ | âœ… å®Œæˆ |
| **æ•´åˆ** | ğŸ”µ å›æ­¸æ¸¬è©¦ | ğŸ”µ E2Eæ¸¬è©¦ | ğŸ”µ æ€§èƒ½æ¸¬è©¦ | ğŸ”µ æ–‡æª” | ğŸ”µ éƒ¨ç½² |

**ç¸½æ™‚ç¨‹**ï¼š38-48 å°æ™‚ï¼ˆåˆ†æ•£åœ¨ 4 é€±ï¼‰

**é—œéµé‡Œç¨‹ç¢‘**ï¼š
- **M1 (W1çµæŸ)**ï¼šAgent A å®Œæˆï¼Œè§£é™¤å…¶ä»– Agent é˜»å¡
- **M2 (W2çµæŸ)**ï¼šAgent B å®Œæˆï¼ŒSlack Bot æ”¯æ´å‹•æ…‹è¡¨å–®
- **M3 (W3çµæŸ)**ï¼šAgent C+D å®Œæˆï¼Œç«¯åˆ°ç«¯æµç¨‹æ‰“é€š
- **M4 (W4çµæŸ)**ï¼šæ‰€æœ‰ Agent å®Œæˆï¼Œæ•´åˆæ¸¬è©¦é€šé

---

## Agent Aï¼šåŸºç¤è¨­æ–½èˆ‡æ ¸å¿ƒæœå‹™

**å„ªå…ˆç´š**ï¼šğŸ”´ æœ€é«˜ï¼ˆç„¡ä¾è³´ï¼Œå¿…é ˆå„ªå…ˆå®Œæˆï¼‰
**æ™‚ç¨‹**ï¼š8-10 å°æ™‚
**è²¬ä»»**ï¼šç”¢å“é…ç½®ç³»çµ± + è³‡æ–™åº« Schema æ“´å±•

### ä¾è³´é …
**ç„¡ä¾è³´**ï¼Œå¯ç«‹å³é–‹å§‹

### äº¤ä»˜ç‰©ï¼ˆInterface Contractï¼‰

#### 1. TypeScript ä»‹é¢
```typescript
// /packages/shared/src/product-configs/types.ts
export type ProductLine = 'ichef' | 'beauty';
export interface ProductLineConfig {
  id: ProductLine;
  name: string;
  displayName: string;
  formFields: FormFieldsConfig;
  prompts: PromptsConfig;
  talkTracks: TalkTracksConfig;
}
```

#### 2. é…ç½® API
```typescript
// /packages/shared/src/product-configs/registry.ts
export function getProductConfig(productLine: ProductLine): ProductLineConfig;
export function getAllProductLines(): ProductLine[];
```

#### 3. è³‡æ–™åº« Schema
```sql
ALTER TABLE opportunities ADD COLUMN product_line TEXT DEFAULT 'ichef' NOT NULL;
ALTER TABLE conversations ADD COLUMN product_line TEXT DEFAULT 'ichef' NOT NULL;
ALTER TABLE talk_tracks ADD COLUMN product_line TEXT DEFAULT 'ichef' NOT NULL;
ALTER TABLE meddic_analyses ADD COLUMN product_line TEXT DEFAULT 'ichef' NOT NULL;

CREATE INDEX idx_opportunities_product_line ON opportunities(product_line);
CREATE INDEX idx_conversations_product_line ON conversations(product_line);
CREATE INDEX idx_talk_tracks_product_line ON talk_tracks(product_line);
CREATE INDEX idx_meddic_analyses_product_line ON meddic_analyses(product_line);
```

### ä»»å‹™æ¸…å–®

**é…ç½®ç³»çµ±** (4-5h)
- [ ] å‰µå»º `/packages/shared/src/product-configs/` ç›®éŒ„
- [ ] å¯¦ä½œ `types.ts` (å®Œæ•´ TypeScript ä»‹é¢å®šç¾©)
- [ ] å¯¦ä½œ `ichef.ts` (å¾ç¾æœ‰ç¡¬ç·¨ç¢¼é·ç§»)
  - å¾ `/apps/slack-bot/src/events/file.ts` æå–è¡¨å–®é¸é …
  - å¾ `/packages/services/prompts/meddic/global-context.md` æå–æç¤ºè©é…ç½®
- [ ] å¯¦ä½œ `beauty.ts` (ç¾æ¥­é…ç½®)
  - åº—é‹ªé¡å‹ï¼šç¾é«®æ²™é¾/ç¾ç”²åº—/ç¾å®¹SPA/åˆºé’/æŒ‰æ‘©/å…¶ä»–
  - å“¡å·¥æ•¸é‡ï¼š1-3äºº/4-10äºº/11-20äºº/20+
  - ç¾æœ‰ç³»çµ±ï¼šç„¡/Excel/LINEé ç´„/å…¶ä»–ç¾æ¥­ç³»çµ±/æ‰‹å¯«æœ¬
  - æ‰¿è«¾äº‹ä»¶ï¼ˆCE1-3ï¼‰ã€è©±è¡“æƒ…å¢ƒï¼ˆ8ç¨®ï¼‰
- [ ] å¯¦ä½œ `registry.ts` (é…ç½®è¨»å†Šèˆ‡æŸ¥è©¢)

**è³‡æ–™åº«æ“´å±•** (3-4h)
- [ ] æ’°å¯« Migration SQL: `/packages/db/migrations/20260116_add_product_line.sql`
- [ ] æ›´æ–° Schema æ–‡ä»¶:
  - `/packages/db/src/schema/opportunity.ts`
  - `/packages/db/src/schema/conversation.ts`
  - `/packages/db/src/schema/talk-tracks.ts`
  - `/packages/db/src/schema/meddic.ts`
- [ ] åŸ·è¡Œ Migration (dev ç’°å¢ƒé©—è­‰)

**æ¸¬è©¦èˆ‡æ–‡æª”** (1h)
- [ ] å–®å…ƒæ¸¬è©¦ï¼š`getProductConfig()`, `getAllProductLines()`
- [ ] é…ç½®çµæ§‹å®Œæ•´æ€§é©—è­‰
- [ ] API ä½¿ç”¨ç¯„ä¾‹æ–‡æª”

### é©—æ”¶æ¨™æº–

```typescript
import { getProductConfig } from '@sales_ai_automation_v3/shared/product-configs';

const beautyConfig = getProductConfig('beauty');
console.log(beautyConfig.displayName); // "ç¾æ¥­ç®¡ç†ç³»çµ±"
console.log(beautyConfig.formFields.storeType.options);
// [{ value: 'hair_salon', label: 'ç¾é«®æ²™é¾', emoji: 'ğŸ’‡' }, ...]
```

**äº¤ä»˜æª¢æŸ¥**ï¼š
- âœ… TypeScript ç·¨è­¯ç„¡éŒ¯èª¤
- âœ… å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ > 80%
- âœ… Migration åŸ·è¡ŒæˆåŠŸ
- âœ… å…¶ä»– Agent å¯ import ä¸¦ä½¿ç”¨

### Mock æ”¯æ´ï¼ˆä¾›å…¶ä»– Agent é–‹ç™¼æœŸé–“ä½¿ç”¨ï¼‰

```typescript
// è‡¨æ™‚ Mockï¼ˆAgent A å®Œæˆå‰å¯ä½¿ç”¨ï¼‰
const mockBeautyConfig: ProductLineConfig = {
  id: 'beauty',
  displayName: 'ç¾æ¥­ç®¡ç†ç³»çµ±',
  formFields: {
    storeType: {
      label: 'åº—é‹ªé¡å‹',
      options: [{ value: 'hair_salon', label: 'ç¾é«®æ²™é¾', emoji: 'ğŸ’‡' }]
    },
    currentSystem: {
      label: 'ç¾æœ‰ç³»çµ±',
      options: [{ value: 'none', label: 'ç„¡', emoji: 'ğŸ†•' }]
    }
  },
  prompts: { globalContext: '', commitmentEvents: [], demoMetaFields: [] },
  talkTracks: { situations: [] }
};
```

---

## Agent Bï¼šSlack Bot å‹•æ…‹è¡¨å–®ç³»çµ±

**å„ªå…ˆç´š**ï¼šğŸ”´ é«˜
**æ™‚ç¨‹**ï¼š8-10 å°æ™‚
**è²¬ä»»**ï¼šChannel è§£æ + å‹•æ…‹è¡¨å–® + File Upload æ•´åˆ

### ä¾è³´é …
- âœ… Agent A çš„ `ProductLineConfig` interface (å¯å…ˆç”¨ mock)
- âœ… Agent A çš„ `getProductConfig()` å‡½æ•¸ (å¯å…ˆç”¨ mock)

### äº¤ä»˜ç‰©

#### 1. Channel è§£æå™¨
```typescript
// /apps/slack-bot/src/utils/product-line-resolver.ts
export function resolveProductLine(channelId: string, env: Env): ProductLine;
// å¾ env.PRODUCT_LINE_CHANNELS è®€å–: {"C12345":"ichef","C67890":"beauty"}
// Fallback: 'ichef'
```

#### 2. å‹•æ…‹è¡¨å–®ç”Ÿæˆå™¨
```typescript
// /apps/slack-bot/src/utils/form-builder.ts
export function buildAudioUploadModal(
  pendingFile: PendingAudioFile,
  productLine: ProductLine
): SlackModalView;

export function parseAudioUploadFormValues(
  values: SlackFormValues,
  productLine: ProductLine
): AudioUploadMetadata;
```

#### 3. File Upload æ•´åˆ
ä¿®æ”¹ `/apps/slack-bot/src/events/file.ts`:
- `handleFileSharedEvent()` è§£æ `productLine`
- Modal çš„ `private_metadata` åŒ…å« `productLine`
- è¡¨å–®æäº¤å‚³é `productLine` åˆ° API

### ä»»å‹™æ¸…å–®

**Channel è§£æ** (2h)
- [ ] å‰µå»º `product-line-resolver.ts`
- [ ] å¾ `env.PRODUCT_LINE_CHANNELS` è§£æ JSON
- [ ] Fallback é‚è¼¯ (é è¨­ 'ichef')
- [ ] ç’°å¢ƒè®Šæ•¸é©—è­‰èˆ‡éŒ¯èª¤è™•ç†

**è¡¨å–®ç”Ÿæˆå™¨** (4-5h)
- [ ] å‰µå»º `form-builder.ts`
- [ ] `buildTextInput()`, `buildSelectInput()` è¼”åŠ©å‡½æ•¸
- [ ] `buildAudioUploadModal()` å‹•æ…‹ç”Ÿæˆé‚è¼¯
  - é€šç”¨æ¬„ä½ï¼šå®¢æˆ¶ç·¨è™Ÿã€å®¢æˆ¶åç¨±ã€æ±ºç­–è€…åœ¨å ´
  - ç”¢å“ç‰¹å®šæ¬„ä½ï¼šæ ¹æ“š config å‹•æ…‹ç”Ÿæˆ
- [ ] `parseAudioUploadFormValues()` è§£æé‚è¼¯
  - iCHEF: storeType, serviceType, currentPos
  - Beauty: beautyType, staffCount, currentBeautySystem

**File Upload æ•´åˆ** (2-3h)
- [ ] ä¿®æ”¹ `file.ts`
  - åœ¨ `handleFileSharedEvent()` èª¿ç”¨ `resolveProductLine()`
  - é‡æ§‹ Modal ç”Ÿæˆä½¿ç”¨ `buildAudioUploadModal()`
  - æ›´æ–° `private_metadata` åŒ…å« `productLine`
  - é‡æ§‹è¡¨å–®è§£æä½¿ç”¨ `parseAudioUploadFormValues()`
  - æ›´æ–° API èª¿ç”¨å‚³é `productLine`
- [ ] æ›´æ–° `/apps/slack-bot/src/types.ts`
  - æ“´å±• `AudioUploadMetadata` æ”¯æ´ç¾æ¥­æ¬„ä½

**æ¸¬è©¦** (1h)
- [ ] å–®å…ƒæ¸¬è©¦ï¼šresolver, builder, parser
- [ ] æ•´åˆæ¸¬è©¦ï¼šiCHEF Channel ä¸Šå‚³ã€Beauty Channel ä¸Šå‚³

### é©—æ”¶æ¨™æº–

**å ´æ™¯ 1ï¼šiCHEF Channel**
```
1. Channel C12345 (é…ç½®ç‚º 'ichef') ä¸Šå‚³éŸ³æª”
2. Modal é¡¯ç¤ºï¼šåº—å‹ã€ç‡Ÿé‹å‹æ…‹ã€ç¾æœ‰POS
3. æäº¤å¾Œ metadata.productLine = 'ichef'
```

**å ´æ™¯ 2ï¼šBeauty Channel**
```
1. Channel C67890 (é…ç½®ç‚º 'beauty') ä¸Šå‚³éŸ³æª”
2. Modal é¡¯ç¤ºï¼šåº—é‹ªé¡å‹ã€å“¡å·¥æ•¸é‡ã€ç¾æœ‰ç³»çµ±
3. æäº¤å¾Œ metadata.productLine = 'beauty'
```

**äº¤ä»˜æª¢æŸ¥**ï¼š
- âœ… TypeScript ç·¨è­¯ç„¡éŒ¯èª¤
- âœ… å–®å…ƒæ¸¬è©¦é€šé
- âœ… å¯¦éš› Slack Bot æ¸¬è©¦é€šé

---

## Agent Cï¼šMEDDIC æç¤ºè©ç³»çµ±

**å„ªå…ˆç´š**ï¼šğŸŸ¡ ä¸­
**æ™‚ç¨‹**ï¼š10-12 å°æ™‚
**è²¬ä»»**ï¼šæç¤ºè©é‡çµ„ + å‹•æ…‹è¼‰å…¥å™¨ + Orchestrator æ•´åˆ

### ä¾è³´é …
- âœ… Agent A çš„ `ProductLineConfig` interface
- âœ… Agent A çš„ `getProductConfig()` å‡½æ•¸

### äº¤ä»˜ç‰©

#### 1. æç¤ºè©ç›®éŒ„çµæ§‹
```
/packages/services/prompts/meddic/
  shared/
    agent1-context-template.md
    agent2-buyer-template.md
    agent3-seller-template.md
    agent4-summary-template.md
    agent5-crm-template.md
    agent6-coach-template.md
  ichef/
    global-context.md
    product-context.md
  beauty/
    global-context.md
    product-context.md
```

#### 2. Prompt Loader
```typescript
// /packages/services/src/llm/prompt-loader.ts
export class PromptLoader {
  loadProductPrompt(productLine: ProductLine, promptName: string): string;
  buildAgentPrompt(productLine: ProductLine, agentName: string, demoMeta?: object): string;
}
```

#### 3. Orchestrator æ›´æ–°
```typescript
// /packages/services/src/llm/orchestrator.ts
export class MeddicOrchestrator {
  constructor(geminiClient: GeminiClient, options: { productLine?: ProductLine });
  async analyze(transcript: Transcript[], metadata: { productLine?: ProductLine }): Promise<AnalysisResult>;
}
```

### ä»»å‹™æ¸…å–®

**æç¤ºè©é‡çµ„** (4-5h)
- [ ] å‰µå»º `prompts/meddic/shared/` ç›®éŒ„
- [ ] é·ç§»é€šç”¨ Agent æ¨¡æ¿åˆ° `shared/`
- [ ] å‰µå»º `prompts/meddic/beauty/` ç›®éŒ„
- [ ] æ’°å¯«ç¾æ¥­æç¤ºè©ï¼š
  - [ ] `global-context.md` (ç¾æ¥­èƒŒæ™¯ã€å®¢æˆ¶ç‰¹å¾µã€æ‰¿è«¾äº‹ä»¶)
  - [ ] `product-context.md` (ç—›é»ã€è½‰æ›é¡§æ…®ã€ç«¶å“)
- [ ] æª¢è¦– Agent 1-6 æ˜¯å¦éœ€è¦ç¾æ¥­ç‰¹å®šèª¿æ•´

**Prompt Loader** (3-4h)
- [ ] å‰µå»º `PromptLoader` é¡åˆ¥
- [ ] `loadProductPrompt()` æ–¹æ³• (æ”¯æ´ fallback åˆ° shared)
- [ ] `buildAgentPrompt()` æ–¹æ³• (çµ„åˆå®Œæ•´æç¤º)
- [ ] å¿«å–æ©Ÿåˆ¶

**Orchestrator æ•´åˆ** (2-3h)
- [ ] ä¿®æ”¹ `MeddicOrchestrator`
  - å»ºæ§‹å‡½æ•¸æ¥å— `productLine` åƒæ•¸
  - `analyze()` æ–¹æ³•å¾ metadata è®€å– `productLine`
  - ä½¿ç”¨ `PromptLoader` å‹•æ…‹è¼‰å…¥æç¤ºè©

**æ¸¬è©¦** (1h)
- [ ] å–®å…ƒæ¸¬è©¦ï¼šLoader, Orchestrator
- [ ] æ•´åˆæ¸¬è©¦ï¼šiCHEF åˆ†æï¼ˆç¢ºä¿å‘å¾Œç›¸å®¹ï¼‰ã€Beauty åˆ†æ

### é©—æ”¶æ¨™æº–

```typescript
// iCHEF åˆ†æ
const orchestrator = new MeddicOrchestrator(gemini, { productLine: 'ichef' });
const result = await orchestrator.analyze(transcript, { productLine: 'ichef' });
// â†’ ä½¿ç”¨ prompts/meddic/ichef/global-context.md
// â†’ åŒ…å«ã€ŒiCHEF POSã€ã€ã€Œèœå–®ç®¡ç†ã€

// Beauty åˆ†æ
const orchestrator = new MeddicOrchestrator(gemini, { productLine: 'beauty' });
const result = await orchestrator.analyze(transcript, { productLine: 'beauty' });
// â†’ ä½¿ç”¨ prompts/meddic/beauty/global-context.md
// â†’ åŒ…å«ã€Œç¾æ¥­ç³»çµ±ã€ã€ã€Œé ç´„ç®¡ç†ã€
```

**äº¤ä»˜æª¢æŸ¥**ï¼š
- âœ… TypeScript ç·¨è­¯ç„¡éŒ¯èª¤
- âœ… å–®å…ƒæ¸¬è©¦é€šé
- âœ… iCHEF åˆ†æå“è³ªä¸ä½æ–¼åŸç³»çµ±
- âœ… Beauty åˆ†æåŒ…å«ç¾æ¥­ç‰¹å®šæ´å¯Ÿ

---

## Agent Dï¼šAPI + Queue Worker æ•´åˆ

**å„ªå…ˆç´š**ï¼šğŸŸ¡ ä¸­
**æ™‚ç¨‹**ï¼š6-8 å°æ™‚
**è²¬ä»»**ï¼šAPI Router æ›´æ–° + Queue Worker æ•´åˆ + ç«¯åˆ°ç«¯æµç¨‹

### ä¾è³´é …
- âœ… Agent A çš„è³‡æ–™åº« Schema (`product_line` æ¬„ä½)
- âœ… Agent C çš„ `MeddicOrchestrator` æ›´æ–° (å¯å…ˆç”¨ mock)

### äº¤ä»˜ç‰©

#### 1. Conversation API
```typescript
// /packages/api/src/routers/conversation.ts
// uploadConversation() æ¥å—ä¸¦å„²å­˜ productLine
```

#### 2. Talk Track API
```typescript
// /packages/api/src/routers/talk-track.ts
getBySituation({ situation, productLine?: 'ichef'|'beauty' })
search({ keyword, productLine?: 'ichef'|'beauty' })
```

#### 3. Analytics API
```typescript
// /packages/api/src/routers/analytics.ts
getDashboardStats({ productLine?: 'ichef'|'beauty', dateRange? })
```

#### 4. Queue Worker
```typescript
// /apps/queue-worker/src/index.ts
// å¾ conversation metadata è®€å– productLine
// å‚³éçµ¦ MeddicOrchestrator
```

### ä»»å‹™æ¸…å–®

**API Router æ›´æ–°** (3-4h)
- [ ] ä¿®æ”¹ `/packages/api/src/routers/conversation.ts`
  - `uploadConversation` æ¥å— `productLine` åƒæ•¸
  - å¯«å…¥ DB æ™‚åŒ…å« `productLine`
- [ ] ä¿®æ”¹ `/packages/api/src/routers/talk-track.ts`
  - æ‰€æœ‰æŸ¥è©¢æ·»åŠ  `productLine` optional åƒæ•¸
  - WHERE æ¢ä»¶éæ¿¾ `product_line`
- [ ] ä¿®æ”¹ `/packages/api/src/routers/analytics.ts`
  - `getDashboardStats` æ·»åŠ  `productLine` éæ¿¾
  - æ‰€æœ‰çµ±è¨ˆæŸ¥è©¢æ”¯æ´ç”¢å“ç·šéš”é›¢

**Queue Worker æ•´åˆ** (2-3h)
- [ ] ä¿®æ”¹ `/apps/queue-worker/src/index.ts`
  - å¾ conversation DB è®€å– `productLine`
  - å‚³é `productLine` åˆ° `MeddicOrchestrator`
  - Slack é€šçŸ¥åŒ…å«ç”¢å“ç·šè³‡è¨Š
- [ ] ä¿®æ”¹ `/apps/slack-bot/src/commands/talk-track.ts`
  - å¾ channel è§£æ `productLine`
  - èª¿ç”¨ API æ™‚å‚³é `productLine`

**æ¸¬è©¦** (1h)
- [ ] å–®å…ƒæ¸¬è©¦ï¼šAPI Router éæ¿¾é‚è¼¯
- [ ] ç«¯åˆ°ç«¯æ¸¬è©¦ï¼šiCHEF æµç¨‹ã€Beauty æµç¨‹

### é©—æ”¶æ¨™æº–

**ç«¯åˆ°ç«¯å ´æ™¯ 1ï¼šiCHEF**
```
1. iCHEF Channel ä¸Šå‚³éŸ³æª”
2. DB: conversation.product_line = 'ichef'
3. MEDDIC åˆ†æä½¿ç”¨ iCHEF æç¤ºè©
4. Slack é€šçŸ¥ï¼šã€Œâœ… iCHEF åˆ†æå®Œæˆã€
```

**ç«¯åˆ°ç«¯å ´æ™¯ 2ï¼šBeauty**
```
1. Beauty Channel ä¸Šå‚³éŸ³æª”
2. DB: conversation.product_line = 'beauty'
3. MEDDIC åˆ†æä½¿ç”¨ Beauty æç¤ºè©
4. Slack é€šçŸ¥ï¼šã€Œâœ… ç¾æ¥­åˆ†æå®Œæˆã€
```

**äº¤ä»˜æª¢æŸ¥**ï¼š
- âœ… TypeScript ç·¨è­¯ç„¡éŒ¯èª¤
- âœ… å–®å…ƒæ¸¬è©¦é€šé
- âœ… ç«¯åˆ°ç«¯æ¸¬è©¦é€šé
- âœ… iCHEF æµç¨‹å‘å¾Œç›¸å®¹

---

## Agent Eï¼šå„€è¡¨æ¿èˆ‡è©±è¡“è³‡æ–™

**å„ªå…ˆç´š**ï¼šğŸŸ¢ ä½
**æ™‚ç¨‹**ï¼š4-6 å°æ™‚
**è²¬ä»»**ï¼šå‰ç«¯ UI + ç¾æ¥­è©±è¡“åˆå§‹è³‡æ–™

### ä¾è³´é …
- âœ… Agent A çš„è³‡æ–™åº« Schema
- âœ… Agent D çš„ API Router æ›´æ–°

### äº¤ä»˜ç‰©

#### 1. ç”¢å“ç·šåˆ‡æ›å™¨
```typescript
// /apps/web/src/components/ProductLineSwitcher.tsx
export function ProductLineSwitcher({
  value: ProductLine | 'all',
  onChange: (value: ProductLine | 'all') => void
}): JSX.Element;
```

#### 2. å„€è¡¨æ¿æ•´åˆ
ä¿®æ”¹ `/apps/web/src/pages/dashboard.tsx`:
- æ·»åŠ  `ProductLineSwitcher` çµ„ä»¶
- æ ¹æ“šé¸æ“‡éæ¿¾æ•¸æ“š

#### 3. ç¾æ¥­è©±è¡“åˆå§‹è³‡æ–™
`/scripts/seed-beauty-talk-tracks.ts`

### ä»»å‹™æ¸…å–®

**å‰ç«¯ UI** (2-3h)
- [ ] å‰µå»º `ProductLineSwitcher.tsx` çµ„ä»¶
  - é¸é …ï¼šæ‰€æœ‰ç”¢å“ç·š / iCHEF é¤é£² / ç¾æ¥­ç³»çµ±
  - ä½¿ç”¨ Shadcn UI Select
- [ ] ä¿®æ”¹ `dashboard.tsx`
  - æ·»åŠ ç”¢å“ç·š state
  - æ·»åŠ åˆ‡æ›å™¨åˆ°é é¢é ‚éƒ¨
  - æ ¹æ“šé¸æ“‡èª¿ç”¨ API (å‚³é `productLine`)

**è©±è¡“è³‡æ–™** (1-2h)
- [ ] å‰µå»º `seed-beauty-talk-tracks.ts` è…³æœ¬
  - 8 ç¨®æƒ…å¢ƒ Ã— 3 è©±è¡“ = 24 ç­†
  - è¨­ç½® `product_line='beauty'`
- [ ] åŸ·è¡Œ seed è…³æœ¬

**æ¸¬è©¦** (1h)
- [ ] UI æ¸¬è©¦ï¼šç”¢å“ç·šåˆ‡æ›å™¨
- [ ] æ•´åˆæ¸¬è©¦ï¼šå„€è¡¨æ¿éæ¿¾åŠŸèƒ½

### é©—æ”¶æ¨™æº–

```
1. å„€è¡¨æ¿é ‚éƒ¨é¡¯ç¤ºç”¢å“ç·šä¸‹æ‹‰é¸å–®
2. é¸æ“‡ã€ŒiCHEF é¤é£²ã€â†’ åªé¡¯ç¤º iCHEF æ•¸æ“š
3. é¸æ“‡ã€Œç¾æ¥­ç³»çµ±ã€â†’ åªé¡¯ç¤ºç¾æ¥­æ•¸æ“š
4. é¸æ“‡ã€Œæ‰€æœ‰ç”¢å“ç·šã€â†’ é¡¯ç¤ºå…¨éƒ¨æ•¸æ“š
```

**äº¤ä»˜æª¢æŸ¥**ï¼š
- âœ… TypeScript ç·¨è­¯ç„¡éŒ¯èª¤
- âœ… React çµ„ä»¶æ¸¬è©¦é€šé
- âœ… ç¾æ¥­è©±è¡“è³‡æ–™å®Œæ•´ï¼ˆ24 ç­†ï¼‰

---

## æ•´åˆæ¸¬è©¦èˆ‡æœ€çµ‚é©—æ”¶

**æ™‚ç¨‹**ï¼š2-4 å°æ™‚
**æ™‚æ©Ÿ**ï¼šæ‰€æœ‰ Agent å®Œæˆå¾Œ

### ç«¯åˆ°ç«¯å ´æ™¯é©—è­‰

#### å ´æ™¯ 1ï¼šiCHEF å‘å¾Œç›¸å®¹
```
ç›®æ¨™ï¼šç¢ºä¿ç¾æœ‰ iCHEF åŠŸèƒ½å®Œå…¨ä¸å—å½±éŸ¿

1. iCHEF Channel ä¸Šå‚³éŸ³æª”
2. å¡«å¯«è¡¨å–®ï¼ˆå’–å•¡å»³ã€å…§ç”¨ç‚ºä¸»ã€iCHEFèˆŠç‰ˆï¼‰
3. é©—è­‰ DB: conversation.product_line = 'ichef'
4. é©—è­‰ MEDDIC åˆ†æå“è³ª >= åŸç³»çµ±
5. é©—è­‰ Slack é€šçŸ¥æ­£å¸¸
6. é©—è­‰å„€è¡¨æ¿é¡¯ç¤ºè©²ç­†è³‡æ–™
```

#### å ´æ™¯ 2ï¼šç¾æ¥­æ–°åŠŸèƒ½
```
ç›®æ¨™ï¼šé©—è­‰ç¾æ¥­ç”¢å“ç·šå®Œæ•´æµç¨‹

1. Beauty Channel ä¸Šå‚³éŸ³æª”
2. å¡«å¯«è¡¨å–®ï¼ˆç¾é«®æ²™é¾ã€4-10äººã€Excelï¼‰
3. é©—è­‰ DB: conversation.product_line = 'beauty'
4. é©—è­‰åˆ†æåŒ…å«ç¾æ¥­ç—›é»ï¼ˆé ç´„ç®¡ç†ã€å“¡å·¥ä½£é‡‘ï¼‰
5. é©—è­‰ Slack é€šçŸ¥æ¨™è¨»ç¾æ¥­
6. é©—è­‰å„€è¡¨æ¿é¡¯ç¤ºè©²ç­†è³‡æ–™
```

#### å ´æ™¯ 3ï¼šè³‡æ–™éš”é›¢
```
ç›®æ¨™ï¼šç¢ºä¿ç”¢å“ç·šè³‡æ–™å®Œå…¨éš”é›¢

1. å‰µå»º iCHEF opportunities Ã— 5
2. å‰µå»º Beauty opportunities Ã— 5
3. æŸ¥è©¢ productLine='ichef' â†’ åªè¿”å› 5 ç­†
4. æŸ¥è©¢ productLine='beauty' â†’ åªè¿”å› 5 ç­†
5. å„€è¡¨æ¿åˆ‡æ›ç”¢å“ç·šï¼Œæ•¸æ“šæ­£ç¢ºéæ¿¾
```

### æ€§èƒ½é©—è­‰

- [ ] è¡¨å–®ç”Ÿæˆæ™‚é–“ < 100ms
- [ ] ç”¢å“ç·šè§£ææ™‚é–“ < 10ms
- [ ] æç¤ºè©è¼‰å…¥æ™‚é–“ < 50ms (å«å¿«å–)
- [ ] è³‡æ–™åº«æŸ¥è©¢æ™‚é–“å¢å¹… < 10%

---

## Agent é–“å”ä½œä»‹é¢ï¼ˆInterface Contractï¼‰

### Agent A â†’ All Agents

**æä¾›æ ¸å¿ƒä»‹é¢**ï¼š
```typescript
// /packages/shared/src/product-configs/types.ts
export type ProductLine = 'ichef' | 'beauty';
export interface ProductLineConfig { /* ... */ }

// /packages/shared/src/product-configs/registry.ts
export function getProductConfig(productLine: ProductLine): ProductLineConfig;
export function getAllProductLines(): ProductLine[];
```

**è³‡æ–™åº« Schema**ï¼š
```sql
-- æ‰€æœ‰è¡¨æ ¼éƒ½æœ‰æ­¤æ¬„ä½
product_line TEXT DEFAULT 'ichef' NOT NULL
```

### Agent C â†’ Agent D

**MEDDIC Orchestrator**ï¼š
```typescript
export class MeddicOrchestrator {
  constructor(geminiClient: GeminiClient, options: { productLine?: ProductLine });
  async analyze(transcript: Transcript[], metadata: { productLine?: ProductLine }): Promise<AnalysisResult>;
}
```

**Mock ç¯„ä¾‹**ï¼ˆAgent D é–‹ç™¼æœŸé–“å¯ç”¨ï¼‰ï¼š
```typescript
class MockOrchestrator {
  async analyze() {
    return { overallScore: 85, contextData: {}, buyerData: {} };
  }
}
```

### Agent D â†’ Agent E

**API Router**ï¼š
```typescript
export const analyticsRouter = router({
  getDashboardStats: protectedProcedure
    .input(z.object({ productLine: z.enum(['ichef', 'beauty']).optional() }))
    .query(async ({ input }) => { /* ... */ })
});
```

---

## ç¾æ¥­ç”¢å“ç·šç‰¹å®šè¨­è¨ˆ

### è¡¨å–®æ¬„ä½å°æ¯”

| æ¬„ä½ | iCHEF | ç¾æ¥­ |
|-----|-------|------|
| **åº—é‹ªé¡å‹** | å’–å•¡å»³/é£²æ–™åº—/ç«é‹åº— (8ç¨®) | ç¾é«®æ²™é¾/ç¾ç”²åº—/ç¾å®¹SPA/åˆºé’/æŒ‰æ‘©/å…¶ä»– |
| **ç‡Ÿé‹æ¨¡å¼** | å…§ç”¨/å¤–å¸¶/å¤–é€ | âŒ ç„¡ |
| **å“¡å·¥æ•¸é‡** | âŒ ç„¡ | 1-3äºº/4-10äºº/11-20äºº/20+ |
| **ç¾æœ‰ç³»çµ±** | ç„¡/iCHEFèˆŠç‰ˆ/DUDU... | ç„¡/Excel/LINEé ç´„/å…¶ä»–ç¾æ¥­ç³»çµ± |

### æ‰¿è«¾äº‹ä»¶ï¼ˆCEï¼‰é‡æ–°å®šç¾©

| CE | iCHEF | ç¾æ¥­ |
|----|-------|------|
| **CE1** | é ç´„å®‰è£/åŸ¹è¨“æœƒè­° | é ç´„ç³»çµ±ç¤ºç¯„/å“¡å·¥åŸ¹è¨“ |
| **CE2** | æäº¤èœå–®/é¤æ¡Œ/åº«å­˜è³‡æ–™ | æäº¤å®¢æˆ¶åå–®/æœå‹™é …ç›®/å®šåƒ¹ |
| **CE3** | ç°½ç´„/ä»˜è¨‚é‡‘ | ç°½ç´„/ä»˜é¦–æœˆè²»ç”¨ |

### ç¾æ¥­ç—›é»èˆ‡è©±è¡“

**ç—›é»**ï¼š
- é ç´„è¡çªï¼ˆé›™é‡é è¨‚ï¼‰
- å“¡å·¥ä½£é‡‘è¨ˆç®—è¤‡é›œ
- æœƒå“¡è³‡æ–™æ•£è½å¤šå¹³å°
- ç·šä¸Šæ”¯ä»˜èˆ‡æ ¸éŠ·å›°é›£

**è©±è¡“æƒ…å¢ƒ**ï¼ˆç¾æ¥­ç‰¹å®šï¼‰ï¼š
- ã€Œå“¡å·¥ä¸æœƒç”¨ã€
- ã€Œå®¢æˆ¶è³‡æ–™è½‰ç§»ã€
- ã€Œé ç´„ç®¡ç†éœ€æ±‚ã€

---

## å‘å¾Œç›¸å®¹æ€§ä¿è­‰

**è³‡æ–™åº«å±¤**ï¼š
- âœ… æ–°æ¬„ä½ä½¿ç”¨ `DEFAULT 'ichef'`
- âœ… Migration åŒ…å« rollback é‚è¼¯

**API å±¤**ï¼š
- âœ… æ–°åƒæ•¸è¨­ç‚º `optional`
- âœ… æœªæŒ‡å®šæ™‚é è¨­ `'ichef'`

**Slack Bot å±¤**ï¼š
- âœ… æœªé…ç½® Channel é è¨­ iCHEF
- âœ… ç¾æœ‰è¡¨å–®æ¬„ä½ä¸è®Š

**æç¤ºè©å±¤**ï¼š
- âœ… `shared/` ä¿ç•™é€šç”¨é‚è¼¯
- âœ… iCHEF æç¤ºè©å…§å®¹ä¸è®Š

---

## é¢¨éšªè©•ä¼°èˆ‡ç·©è§£

### é¢¨éšª 1ï¼šAgent é–“å”ä½œè¡çª
- **å½±éŸ¿**ï¼šä¸­ | **æ¦‚ç‡**ï¼šä¸­
- **ç·©è§£**ï¼šæ˜ç¢º Interface Contractã€Agent A å„ªå…ˆå®Œæˆã€æä¾› Mock æ”¯æ´

### é¢¨éšª 2ï¼šå‘å¾Œç›¸å®¹æ€§ç ´å£
- **å½±éŸ¿**ï¼šé«˜ | **æ¦‚ç‡**ï¼šä½
- **ç·©è§£**ï¼šDEFAULT å€¼ã€å®Œæ•´å›æ­¸æ¸¬è©¦

### é¢¨éšª 3ï¼šæç¤ºè©å“è³ªä¸‹é™
- **å½±éŸ¿**ï¼šé«˜ | **æ¦‚ç‡**ï¼šä¸­
- **ç·©è§£**ï¼šA/B æ¸¬è©¦ã€å‚™ä»½åŸå§‹æç¤ºè©

---

## æˆåŠŸæ¨™æº–

**åŠŸèƒ½å®Œæ•´æ€§**ï¼š
- âœ… ç¾æ¥­ Channel å¯ä¸Šå‚³éŸ³æª”ä¸¦å¡«å¯«å°ˆå±¬è¡¨å–®
- âœ… ç¾æ¥­å°è©±ä½¿ç”¨å°ˆå±¬ MEDDIC æç¤ºè©åˆ†æ
- âœ… è©±è¡“ç³»çµ±æ­£ç¢ºéæ¿¾ç”¢å“ç·š
- âœ… å„€è¡¨æ¿å¯æŒ‰ç”¢å“ç·šç¯©é¸
- âœ… iCHEF åŠŸèƒ½å®Œå…¨ä¸å—å½±éŸ¿

**æ€§èƒ½è¦æ±‚**ï¼š
- âœ… è¡¨å–®ç”Ÿæˆ < 100ms
- âœ… ç”¢å“ç·šè§£æ < 10ms
- âœ… æç¤ºè©è¼‰å…¥ < 50ms
- âœ… æŸ¥è©¢æ™‚é–“å¢å¹… < 10%

**å¯ç¶­è­·æ€§**ï¼š
- âœ… æ–°å¢ç¬¬ä¸‰å€‹ç”¢å“ç·š < 4h
- âœ… å®Œæ•´ TypeScript é¡å‹è¦†è“‹
- âœ… æ–‡æª”å®Œæ•´

**å”ä½œæ•ˆç‡**ï¼š
- âœ… Agent é–“ç„¡é˜»å¡ç­‰å¾…ï¼ˆé™¤ Agent Aï¼‰
- âœ… Interface Contract æ¸…æ™°æ˜ç¢º
- âœ… 4 é€±å…§å®Œæˆ
- âœ… æ•´åˆæ¸¬è©¦ä¸€æ¬¡é€šé

---

## å¾ŒçºŒæ“´å±•è¨ˆç•«

### ç¬¬ä¸‰å€‹ç”¢å“ç·šæº–å‚™
- é…ç½®æ¡†æ¶å·²å°±ç·’
- åªéœ€æ·»åŠ æ–°é…ç½®æ–‡ä»¶å’Œæç¤ºè©
- **é ä¼°å·¥æ™‚**ï¼š3-4 å°æ™‚
