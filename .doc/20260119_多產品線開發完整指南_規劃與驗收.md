# å¤šç”¢å“ç·šæ”¯æ´é–‹ç™¼å®Œæ•´æŒ‡å— (è¦åŠƒ + é©—æ”¶)

> **æ•´åˆæ–‡ä»¶**: çµåˆã€Œå¯¦ä½œè¨ˆç•«ã€å’Œã€Œé©—æ”¶æ¢ä»¶ã€
> **é©ç”¨å°è±¡**: é–‹ç™¼åœ˜éšŠã€æ¸¬è©¦åœ˜éšŠã€éƒ¨ç½²åœ˜éšŠ
> **ç‰ˆæœ¬**: v1.0 (å·²ä¿®æ­£æŠ€è¡“è¡çª)

---

## ğŸ“š æ–‡ä»¶å°è¦½

æœ¬æ–‡ä»¶æ•´åˆä»¥ä¸‹å…§å®¹:
1. âœ… **ä¿®æ­£ç‰ˆå¯¦ä½œè¨ˆç•«** (Agent A-E è©³ç´°ä»»å‹™)
2. âœ… **é©—æ”¶æ¢ä»¶** (æ¯å€‹ Agent çš„æª¢æŸ¥é»)
3. âœ… **å‘å¾Œç›¸å®¹æ€§æ¸¬è©¦** (ç¢ºä¿ä¸å½±éŸ¿ç¾æœ‰ä½¿ç”¨)
4. âœ… **éƒ¨ç½²ç­–ç•¥** (åˆ†éšæ®µéƒ¨ç½²è¨ˆç•«)

**å»ºè­°é–±è®€é †åº**:
- é–‹ç™¼äººå“¡: å…ˆçœ‹ã€ŒAgent è©³ç´°ä»»å‹™ã€â†’ å†çœ‹ã€Œé©—æ”¶æ¢ä»¶ã€
- æ¸¬è©¦äººå“¡: å…ˆçœ‹ã€Œé©—æ”¶æ¢ä»¶ã€â†’ å†çœ‹ã€Œå›æ­¸æ¸¬è©¦æ¸…å–®ã€
- éƒ¨ç½²äººå“¡: ç›´æ¥çœ‹ã€Œåˆ†éšæ®µéƒ¨ç½²è¨ˆç•«ã€

---

## ç›®éŒ„

- [åŸ·è¡Œæ‘˜è¦](#åŸ·è¡Œæ‘˜è¦)
- [æŠ€è¡“ä¿®æ­£èªªæ˜](#æŠ€è¡“ä¿®æ­£èªªæ˜)
- [Agent A: åŸºç¤è¨­æ–½](#agent-aåŸºç¤è¨­æ–½èˆ‡æ ¸å¿ƒæœå‹™)
- [Agent B: Slack Bot](#agent-b-slack-bot-å‹•æ…‹è¡¨å–®ç³»çµ±)
- [Agent C: MEDDIC Prompts](#agent-c-meddic-æç¤ºè©ç³»çµ±)
- [Agent D: API + Queue](#agent-d-api--queue-worker-æ•´åˆ)
- [Agent E: Dashboard](#agent-e-å„€è¡¨æ¿èˆ‡è©±è¡“è³‡æ–™)
- [æ•´åˆæ¸¬è©¦](#æ•´åˆæ¸¬è©¦èˆ‡æœ€çµ‚é©—æ”¶)
- [éƒ¨ç½²è¨ˆç•«](#åˆ†éšæ®µéƒ¨ç½²è¨ˆç•«)

---

## åŸ·è¡Œæ‘˜è¦

### ğŸ¯ ç›®æ¨™

å°‡ç¾æœ‰çš„ iCHEF é¤é£² POS éŠ·å”®åˆ†æç³»çµ±æ“´å±•ç‚ºæ”¯æ´å¤šç”¢å“ç·šæ¶æ§‹ï¼Œé¦–å…ˆæ”¯æ´ç¾æ¥­ç”¢å“ç·šã€‚

### ğŸ”‘ æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

1. **é…ç½®é©…å‹•** - æ‰€æœ‰ç”¢å“ç·šç‰¹å®šé‚è¼¯å¾ä¸­å¤®é…ç½®è®€å–
2. **å‘å¾Œç›¸å®¹** - ä¸ç ´å£ç¾æœ‰ iCHEF åŠŸèƒ½ï¼Œæ‰€æœ‰æ–°æ¬„ä½ä½¿ç”¨é è¨­å€¼
3. **å¯æ“´å±•** - æœªä¾†æ–°å¢ç¬¬ä¸‰å€‹ç”¢å“ç·šåƒ…éœ€ 3-4 å°æ™‚
4. **é—œæ³¨é»åˆ†é›¢** - é€šç”¨é‚è¼¯èˆ‡ç”¢å“ç‰¹å®šé‚è¼¯æ¸…æ™°åˆ†é›¢
5. **ä¸¦è¡Œé–‹ç™¼** - 5 å€‹ç¨ç«‹æ¨¡çµ„å¯ç”±ä¸åŒ Agent åŒæ­¥é–‹ç™¼

### ğŸ“Š é–‹ç™¼æ™‚ç¨‹

| Agent | æ™‚ç¨‹ | å„ªå…ˆç´š | ä¾è³´ |
|-------|------|--------|------|
| Agent A | 8-10h | ğŸ”´ æœ€é«˜ | ç„¡ |
| Agent B | 8-10h | ğŸ”´ é«˜ | Agent A (å¯ç”¨ mock) |
| Agent C | 12-14h | ğŸŸ¡ ä¸­ | Agent A (å¯ç”¨ mock) |
| Agent D | 6-8h | ğŸŸ¡ ä¸­ | Agent A + C |
| Agent E | 4-6h | ğŸŸ¢ ä½ | Agent A + D |

**ç¸½æ™‚ç¨‹**: 38-48 å°æ™‚ (åˆ†æ•£åœ¨ 4 é€±)

---

## æŠ€è¡“ä¿®æ­£èªªæ˜

> âš ï¸ **é‡è¦**: åŸå§‹è¦åŠƒå·²æ ¹æ“šå°ˆæ¡ˆå¯¦éš›æŠ€è¡“æ¶æ§‹ä¿®æ­£

### å·²ä¿®æ­£çš„æŠ€è¡“è¡çª

1. âœ… **Migration æª”å**: `20260116_add_product_line.sql` â†’ `0003_add_product_line.sql`
2. âœ… **Migration è·¯å¾‘**: `/packages/db/migrations/` â†’ `/packages/db/src/migrations/`
3. âœ… **Prompts ç·¨è­¯**: æ–°å¢ç·¨è­¯è…³æœ¬æ›´æ–°ä»»å‹™
4. âœ… **Orchestrator åƒæ•¸**: ä¿ç•™æ‰€æœ‰ç¾æœ‰ metadata æ¬„ä½
5. âœ… **Package import**: ä½¿ç”¨ `@Sales_ai_automation_v3/` (å¤§å¯« S)

è©³è¦‹: [ä¿®æ­£ç‰ˆè¦åŠƒæ–‡ä»¶](.doc/20260119_ä¿®æ­£ç‰ˆ_å¤šç”¢å“ç·šæ”¯æ´å¯¦ä½œè¨ˆç•«.md)

---

# Agent Aï¼šåŸºç¤è¨­æ–½èˆ‡æ ¸å¿ƒæœå‹™

**å„ªå…ˆç´š**: ğŸ”´ æœ€é«˜ï¼ˆç„¡ä¾è³´ï¼Œå¿…é ˆå„ªå…ˆå®Œæˆï¼‰  
**æ™‚ç¨‹**: 8-10 å°æ™‚  
**è²¬ä»»**: ç”¢å“é…ç½®ç³»çµ± + è³‡æ–™åº« Schema æ“´å±•

---

## ğŸ“‹ è©³ç´°ä»»å‹™æ¸…å–®

### é…ç½®ç³»çµ± (4-5h)

#### ä»»å‹™ 1: å‰µå»ºç›®éŒ„çµæ§‹
```bash
mkdir -p /packages/shared/src/product-configs
cd /packages/shared/src/product-configs
```

#### ä»»å‹™ 2: å¯¦ä½œ types.ts
```typescript
// /packages/shared/src/product-configs/types.ts
export type ProductLine = 'ichef' | 'beauty';

export interface FormFieldOption {
  value: string;
  label: string;
  emoji?: string;
}

export interface FormFieldConfig {
  label: string;
  options: FormFieldOption[];
  required?: boolean;
}

export interface FormFieldsConfig {
  storeType: FormFieldConfig;
  serviceType?: FormFieldConfig;  // iCHEF only
  staffCount?: FormFieldConfig;   // Beauty only
  currentSystem: FormFieldConfig;
}

export interface CommitmentEvent {
  id: 'CE1' | 'CE2' | 'CE3';
  name: string;
  definition: string;
}

export interface PromptsConfig {
  globalContext: string;
  productContext: string;
  commitmentEvents: CommitmentEvent[];
  demoMetaFields: string[];
}

export interface TalkTrackSituation {
  id: string;
  name: string;
  description: string;
}

export interface TalkTracksConfig {
  situations: TalkTrackSituation[];
}

export interface ProductLineConfig {
  id: ProductLine;
  name: string;
  displayName: string;
  formFields: FormFieldsConfig;
  prompts: PromptsConfig;
  talkTracks: TalkTracksConfig;
}
```

#### ä»»å‹™ 3: å¯¦ä½œ ichef.ts
å¾ç¾æœ‰ç¨‹å¼ç¢¼æå– iCHEF é…ç½®:
- è¡¨å–®é¸é …: `/apps/slack-bot/src/events/file.ts`
- æç¤ºè©åƒè€ƒ: `/packages/services/prompts/meddic/global-context.md`

#### ä»»å‹™ 4: å¯¦ä½œ beauty.ts
å‰µå»ºç¾æ¥­é…ç½®:
- åº—é‹ªé¡å‹: ç¾é«®æ²™é¾/ç¾ç”²åº—/ç¾å®¹SPA/åˆºé’/æŒ‰æ‘©/å…¶ä»–
- å“¡å·¥æ•¸é‡: 1-3äºº/4-10äºº/11-20äºº/20+
- ç¾æœ‰ç³»çµ±: ç„¡/Excel/LINEé ç´„/å…¶ä»–ç¾æ¥­ç³»çµ±/æ‰‹å¯«æœ¬

#### ä»»å‹™ 5: å¯¦ä½œ registry.ts
```typescript
import type { ProductLine, ProductLineConfig } from './types';
import { ichefConfig } from './ichef';
import { beautyConfig } from './beauty';

const configs = new Map<ProductLine, ProductLineConfig>([
  ['ichef', ichefConfig],
  ['beauty', beautyConfig],
]);

export function getProductConfig(productLine: ProductLine): ProductLineConfig {
  const config = configs.get(productLine);
  if (!config) {
    throw new Error(`Unknown product line: ${productLine}`);
  }
  return config;
}

export function getAllProductLines(): ProductLine[] {
  return Array.from(configs.keys());
}

export function getDefaultProductLine(): ProductLine {
  return 'ichef';
}
```

#### ä»»å‹™ 6: æ›´æ–° package.json
```json
{
  "name": "@Sales_ai_automation_v3/shared",
  "exports": {
    "./product-configs": "./src/product-configs/index.ts",
    "./product-configs/*": "./src/product-configs/*.ts",
    "./types/*": "./src/types/*/index.ts",
    "./errors": "./src/errors/index.ts"
  }
}
```

---

### è³‡æ–™åº«æ“´å±• (3-4h)

#### ä»»å‹™ 1: æ’°å¯« Migration SQL
```sql
-- /packages/db/src/migrations/0003_add_product_line.sql
-- âš ï¸ æ³¨æ„: ä½¿ç”¨ Drizzle ORM å‘½åæ…£ä¾‹

ALTER TABLE opportunities ADD COLUMN product_line TEXT DEFAULT 'ichef' NOT NULL;
ALTER TABLE conversations ADD COLUMN product_line TEXT DEFAULT 'ichef' NOT NULL;
ALTER TABLE talk_tracks ADD COLUMN product_line TEXT DEFAULT 'ichef' NOT NULL;
ALTER TABLE meddic_analyses ADD COLUMN product_line TEXT DEFAULT 'ichef' NOT NULL;

CREATE INDEX idx_opportunities_product_line ON opportunities(product_line);
CREATE INDEX idx_conversations_product_line ON conversations(product_line);
CREATE INDEX idx_talk_tracks_product_line ON talk_tracks(product_line);
CREATE INDEX idx_meddic_analyses_product_line ON meddic_analyses(product_line);
```

#### ä»»å‹™ 2: æ›´æ–° Schema æ–‡ä»¶

**opportunities.ts**:
```typescript
export const opportunities = pgTable("opportunities", {
  // ... ç¾æœ‰æ¬„ä½
  productLine: text("product_line").default('ichef').notNull(),
  // ...
});
```

**conversations.ts**:
```typescript
export const conversations = pgTable("conversations", {
  // ... ç¾æœ‰æ¬„ä½
  productLine: text("product_line").default('ichef').notNull(),
  // ...
});
```

**talk-tracks.ts**, **meddic.ts** åŒæ¨£è™•ç†

#### ä»»å‹™ 3: åŸ·è¡Œ Migration
```bash
bun run db:migrate
```

---

### æ¸¬è©¦ (1h)

#### å–®å…ƒæ¸¬è©¦
```typescript
// packages/shared/src/product-configs/__tests__/registry.test.ts
import { describe, expect, it } from 'vitest';
import { getProductConfig, getAllProductLines } from '../registry';

describe('ProductConfig Registry', () => {
  it('should get iCHEF config', () => {
    const config = getProductConfig('ichef');
    expect(config.id).toBe('ichef');
    expect(config.displayName).toBe('iCHEF POS ç³»çµ±');
  });

  it('should get Beauty config', () => {
    const config = getProductConfig('beauty');
    expect(config.id).toBe('beauty');
    expect(config.displayName).toBe('ç¾æ¥­ç®¡ç†ç³»çµ±');
  });

  it('should list all product lines', () => {
    const lines = getAllProductLines();
    expect(lines).toEqual(['ichef', 'beauty']);
  });
});
```

---

## âœ… é©—æ”¶æª¢æŸ¥é» 1 - Agent A

### ğŸ“‹ åŠŸèƒ½é©—æ”¶

**æ¸¬è©¦ 1: é…ç½®ç³»çµ±å¯ç”¨**
```bash
bun run -e "
import { getProductConfig, getAllProductLines } from '@Sales_ai_automation_v3/shared/product-configs';
const ichef = getProductConfig('ichef');
const beauty = getProductConfig('beauty');
const all = getAllProductLines();
console.log('âœ“ iCHEF:', ichef.displayName);
console.log('âœ“ Beauty:', beauty.displayName);
console.log('âœ“ All:', all);
"
```
**é æœŸè¼¸å‡º**:
```
âœ“ iCHEF: iCHEF POS ç³»çµ±
âœ“ Beauty: ç¾æ¥­ç®¡ç†ç³»çµ±
âœ“ All: [ 'ichef', 'beauty' ]
```

**æ¸¬è©¦ 2: Migration åŸ·è¡ŒæˆåŠŸ**
```bash
# åŸ·è¡Œ Migration
bun run db:migrate

# é©—è­‰æ¬„ä½å­˜åœ¨
psql $DATABASE_URL -c "
SELECT table_name, column_name, column_default 
FROM information_schema.columns 
WHERE column_name = 'product_line' 
AND table_name IN ('opportunities', 'conversations', 'talk_tracks', 'meddic_analyses');
"
```
**é æœŸçµæœ**: 4 å€‹è¡¨æ ¼éƒ½æœ‰ `product_line` æ¬„ä½ï¼Œé è¨­å€¼ç‚º `'ichef'`

**æ¸¬è©¦ 3: ç¾æœ‰è³‡æ–™å®Œæ•´æ€§**
```sql
-- æª¢æŸ¥æ‰€æœ‰ç¾æœ‰è³‡æ–™æ˜¯å¦è‡ªå‹•è¨­å®šç‚º 'ichef'
SELECT
  'opportunities' as table_name,
  COUNT(*) as total_rows,
  COUNT(*) FILTER (WHERE product_line = 'ichef') as ichef_rows
FROM opportunities
UNION ALL
SELECT 'conversations', COUNT(*), COUNT(*) FILTER (WHERE product_line = 'ichef')
FROM conversations
UNION ALL
SELECT 'talk_tracks', COUNT(*), COUNT(*) FILTER (WHERE product_line = 'ichef')
FROM talk_tracks
UNION ALL
SELECT 'meddic_analyses', COUNT(*), COUNT(*) FILTER (WHERE product_line = 'ichef')
FROM meddic_analyses;
```
**é æœŸçµæœ**: æ¯å€‹è¡¨æ ¼çš„ `total_rows` = `ichef_rows` (æ‰€æœ‰è³‡æ–™éƒ½æ¨™è¨˜ç‚º ichef)

### âš ï¸ å‘å¾Œç›¸å®¹æ€§é©—æ”¶ (é—œéµ!)

**æ¸¬è©¦ 1: æŸ¥è©¢ä¸éœ€è¦éæ¿¾ product_line**
```typescript
// ç¾æœ‰æŸ¥è©¢æ–¹å¼ (ä¸éæ¿¾ product_line)
const opportunities = await db.query.opportunities.findMany({
  where: eq(opportunities.userId, 'test-user')
  // ä¸éæ¿¾ product_line â†’ æ‡‰è©²å›å‚³æ‰€æœ‰è³‡æ–™
});

console.log('Found opportunities:', opportunities.length);
console.log('All are ichef:', opportunities.every(o => o.productLine === 'ichef'));
```
**çµæœ**: âœ… å¿…é ˆç‚º `true`

**æ¸¬è©¦ 2: Insert ä¸éœ€è¦æŒ‡å®š product_line**
```typescript
// ä¸æŒ‡å®š product_line
const newOpp = await db.insert(opportunities).values({
  id: randomUUID(),
  userId: 'test-user',
  customerNumber: `202601-TEST${Date.now()}`,
  companyName: 'Test Company'
  // ä¸æŒ‡å®š product_line
}).returning();

console.log('Product Line:', newOpp[0].productLine);
```
**çµæœ**: âœ… å¿…é ˆæ˜¯ `'ichef'`

### ğŸ§ª å“è³ªé©—æ”¶

- [ ] TypeScript ç·¨è­¯ç„¡éŒ¯èª¤: `bun run check-types`
- [ ] å–®å…ƒæ¸¬è©¦é€šé: `bun run test packages/shared`
- [ ] Linting é€šé: `bun x ultracite check`
- [ ] æ¸¬è©¦è¦†è“‹ç‡ > 80%: `bun run test:coverage`

### ğŸ“Š æ€§èƒ½é©—æ”¶

**Index é©—è­‰**:
```sql
SELECT indexname, indexdef 
FROM pg_indexes
WHERE tablename IN ('opportunities', 'conversations', 'talk_tracks', 'meddic_analyses')
AND indexname LIKE '%product_line%';
```
**é æœŸçµæœ**: 4 å€‹ Index éƒ½å­˜åœ¨

**æŸ¥è©¢æ€§èƒ½æ¸¬è©¦**:
```sql
EXPLAIN ANALYZE 
SELECT * FROM conversations 
WHERE product_line = 'ichef' 
LIMIT 100;
```
**é æœŸçµæœ**: ä½¿ç”¨ Index Scanï¼ŒåŸ·è¡Œæ™‚é–“ < 50ms

### ğŸš« ä¸é€šéæ¨™æº– (å¿…é ˆä¿®æ­£)

å¦‚æœä»¥ä¸‹ä»»ä¸€æ¢ä»¶ä¸ç¬¦åˆï¼Œ**åœæ­¢é€²å…¥ä¸‹ä¸€éšæ®µ**:

- âŒ Migration åŸ·è¡Œå¤±æ•—
- âŒ TypeScript ç·¨è­¯éŒ¯èª¤
- âŒ å–®å…ƒæ¸¬è©¦å¤±æ•—
- âŒ ç¾æœ‰è³‡æ–™ product_line ä¸æ˜¯ 'ichef'
- âŒ Index æœªå»ºç«‹
- âŒ Package import å¤±æ•—

---

# Agent B: Slack Bot å‹•æ…‹è¡¨å–®ç³»çµ±

**å„ªå…ˆç´š**: ğŸ”´ é«˜  
**æ™‚ç¨‹**: 8-10 å°æ™‚  
**è²¬ä»»**: Channel è§£æ + å‹•æ…‹è¡¨å–® + File Upload æ•´åˆ

## ä¾è³´é …
- âœ… Agent A çš„ `ProductLineConfig` interface (å¯å…ˆç”¨ mock)
- âœ… Agent A çš„ `getProductConfig()` å‡½æ•¸ (å¯å…ˆç”¨ mock)

---

## ğŸ“‹ è©³ç´°ä»»å‹™æ¸…å–®

[ç¹¼çºŒå®Œæ•´å…§å®¹...]

