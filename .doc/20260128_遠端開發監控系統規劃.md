# é ç«¯é–‹ç™¼ç›£æ§ç³»çµ±è¦åŠƒ

> **ç›®æ¨™**ï¼šé€é iOS æ‰‹æ©Ÿ + Telegramï¼Œå³æ™‚ç›£æ§ Mac é›»è…¦ä¸Šçš„ Claude Code é–‹ç™¼é€²åº¦ï¼Œä¸¦èƒ½é ç«¯ä¸‹é”æŒ‡ä»¤

---

## ä¸€ã€ç³»çµ±æ¶æ§‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           å…¬å¸ Mac é›»è…¦                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Claude Code   â”‚â”€â”€â”€â–¶â”‚   Hook Scripts  â”‚â”€â”€â”€â–¶â”‚  Local Bridge   â”‚     â”‚
â”‚  â”‚   (VS Code)     â”‚    â”‚   (äº‹ä»¶ç›£è½)     â”‚    â”‚   (HTTP API)    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                          â”‚              â”‚
â”‚                                                          â–¼              â”‚
â”‚                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                                               â”‚ Cloudflare      â”‚       â”‚
â”‚                                               â”‚ Tunnel          â”‚       â”‚
â”‚                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â–¼                                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Telegram Bot   â”‚                         â”‚   Web Dashboard â”‚
                   â”‚  (Cloudflare    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   (å¯é¸)        â”‚
                   â”‚   Workers)      â”‚                         â”‚                 â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   iOS æ‰‹æ©Ÿ      â”‚
                   â”‚   Telegram App  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ ¸å¿ƒå…ƒä»¶èªªæ˜

### 1. Claude Code Hooksï¼ˆMac æœ¬åœ°ï¼‰

åˆ©ç”¨ Claude Code å…§å»ºçš„ Hooks æ©Ÿåˆ¶ï¼Œåœ¨é—œéµäº‹ä»¶è§¸ç™¼æ™‚è‡ªå‹•åŸ·è¡Œè…³æœ¬ï¼š

| Hook äº‹ä»¶ | è§¸ç™¼æ™‚æ©Ÿ | ç”¨é€” |
|-----------|----------|------|
| `SessionStart` | é–‹å§‹æ–°å·¥ä½œéšæ®µ | é€šçŸ¥ã€Œé–‹ç™¼å·²é–‹å§‹ã€ |
| `UserPromptSubmit` | ç”¨æˆ¶æäº¤æŒ‡ä»¤ | è¨˜éŒ„æŒ‡ä»¤å…§å®¹ |
| `PreToolUse` | å·¥å…·åŸ·è¡Œå‰ | è¨˜éŒ„å³å°‡åŸ·è¡Œçš„æ“ä½œ |
| `PostToolUse` | å·¥å…·åŸ·è¡Œå¾Œ | å›å ±åŸ·è¡Œçµæœ |
| `Notification` | Claude ç™¼é€é€šçŸ¥ | è½‰ç™¼åˆ° Telegram |

**Hook é…ç½®ç¯„ä¾‹** (`~/.claude/settings.json`)ï¼š
```json
{
  "hooks": {
    "SessionStart": [
      {
        "type": "command",
        "command": "~/.claude/hooks/notify-telegram.sh session_start"
      }
    ],
    "PostToolUse": [
      {
        "type": "command",
        "command": "~/.claude/hooks/notify-telegram.sh tool_complete",
        "matcher": ["Bash", "Write", "Edit"]
      }
    ],
    "Notification": [
      {
        "type": "command",
        "command": "~/.claude/hooks/notify-telegram.sh notification"
      }
    ]
  }
}
```

### 2. Local Bridgeï¼ˆMac æœ¬åœ° HTTP æœå‹™ï¼‰

ä¸€å€‹è¼•é‡ç´šçš„æœ¬åœ° HTTP æœå‹™ï¼Œè² è²¬ï¼š
- æ¥æ”¶ä¾†è‡ª Telegram Bot çš„æŒ‡ä»¤
- æ§åˆ¶ Claude Codeï¼ˆé€é CLIï¼‰
- å›å ±ç‹€æ…‹å’Œæ—¥èªŒ

**æŠ€è¡“é¸æ“‡**ï¼šBun + Honoï¼ˆèˆ‡ç¾æœ‰å°ˆæ¡ˆä¸€è‡´ï¼‰

### 3. Cloudflare Tunnelï¼ˆå®‰å…¨éš§é“ï¼‰

å°‡ Mac æœ¬åœ°æœå‹™å®‰å…¨åœ°æš´éœ²åˆ°ç¶²éš›ç¶²è·¯ï¼š
- **å…è²»**
- **ç„¡éœ€å›ºå®š IP**
- **è‡ªå‹• HTTPS**
- **æ•´åˆ Zero Trust èªè­‰**

### 4. Telegram Botï¼ˆCloudflare Workersï¼‰

éƒ¨ç½²åœ¨ Cloudflare Workersï¼Œè² è²¬ï¼š
- æ¥æ”¶ç”¨æˆ¶æŒ‡ä»¤
- è½‰ç™¼åˆ° Local Bridge
- æ¨é€é–‹ç™¼é€²åº¦é€šçŸ¥

---

## ä¸‰ã€åŠŸèƒ½è¦æ ¼

### A. ç›£æ§åŠŸèƒ½ï¼ˆMac â†’ Telegramï¼‰

| åŠŸèƒ½ | è§¸ç™¼æ–¹å¼ | é€šçŸ¥å…§å®¹ |
|------|----------|----------|
| å·¥ä½œéšæ®µé–‹å§‹ | SessionStart Hook | ã€ŒğŸš€ é–‹ç™¼å·²é–‹å§‹ï¼š{å°ˆæ¡ˆåç¨±}ã€ |
| æŒ‡ä»¤åŸ·è¡Œä¸­ | PreToolUse Hook | ã€Œâš™ï¸ æ­£åœ¨åŸ·è¡Œï¼š{å·¥å…·åç¨±}ã€ |
| æŒ‡ä»¤å®Œæˆ | PostToolUse Hook | ã€Œâœ… å®Œæˆï¼š{å·¥å…·åç¨±} - {æ‘˜è¦}ã€ |
| Claude å›è¦† | Notification Hook | ã€ŒğŸ’¬ Claudeï¼š{å›è¦†æ‘˜è¦}ã€ |
| Git æ“ä½œ | PostToolUse (Bash) | ã€ŒğŸ“¦ Gitï¼š{commit/push/PR è³‡è¨Š}ã€ |
| éŒ¯èª¤ç™¼ç”Ÿ | Exit Code 2 | ã€ŒâŒ éŒ¯èª¤ï¼š{éŒ¯èª¤è¨Šæ¯}ã€ |
| ä»»å‹™å®Œæˆ | æ‰‹å‹•/è‡ªå‹•åˆ¤æ–· | ã€ŒğŸ‰ ä»»å‹™å®Œæˆï¼ã€ |

### B. æ§åˆ¶åŠŸèƒ½ï¼ˆTelegram â†’ Macï¼‰

| æŒ‡ä»¤ | åŠŸèƒ½ | å¯¦ç¾æ–¹å¼ |
|------|------|----------|
| `/status` | æŸ¥è©¢ç•¶å‰ç‹€æ…‹ | è®€å– Claude Code å·¥ä½œéšæ®µ |
| `/task {æŒ‡ä»¤}` | ä¸‹é”æ–°ä»»å‹™ | `claude -p "{æŒ‡ä»¤}"` |
| `/continue` | ç¹¼çºŒç•¶å‰ä»»å‹™ | `claude --continue` |
| `/resume {id}` | æ¢å¾©ç‰¹å®šå·¥ä½œéšæ®µ | `claude --resume {id}` |
| `/stop` | ä¸­æ–·ç•¶å‰ä»»å‹™ | ç™¼é€ SIGINT |
| `/logs` | æŸ¥çœ‹æœ€è¿‘æ—¥èªŒ | è®€å–æ—¥èªŒæª”æ¡ˆ |
| `/git status` | Git ç‹€æ…‹ | `git status` |
| `/git commit {msg}` | Git æäº¤ | `git commit -m "{msg}"` |
| `/git push` | Git æ¨é€ | `git push` |
| `/deploy {env}` | éƒ¨ç½² | åŸ·è¡Œéƒ¨ç½²è…³æœ¬ |
| `/approve` | å¯©æ ¸é€šé | ç¹¼çºŒè¢«é˜»å¡çš„æ“ä½œ |
| `/reject` | å¯©æ ¸æ‹’çµ• | å–æ¶ˆè¢«é˜»å¡çš„æ“ä½œ |

### C. å®‰å…¨æ©Ÿåˆ¶

| å±¤ç´š | æ©Ÿåˆ¶ | èªªæ˜ |
|------|------|------|
| ç¶²è·¯å±¤ | Cloudflare Tunnel | å‡ºç«™é€£æ¥ï¼Œç„¡éœ€é–‹æ”¾ç«¯å£ |
| å‚³è¼¸å±¤ | HTTPS + mTLS | Cloudflare è‡ªå‹•è™•ç† |
| æ‡‰ç”¨å±¤ | Telegram Chat ID ç™½åå–® | åªå…è¨±æˆæ¬Šç”¨æˆ¶ |
| èªè­‰å±¤ | Webhook Secret Token | é©—è­‰è«‹æ±‚ä¾†æº |
| æ“ä½œå±¤ | æ•æ„Ÿæ“ä½œäºŒæ¬¡ç¢ºèª | deploy/push éœ€ç¢ºèª |

---

## å››ã€æŠ€è¡“å¯¦ä½œç´°ç¯€

### Phase 1ï¼šåŸºç¤è¨­æ–½ï¼ˆé è¨ˆ 1-2 å¤©ï¼‰

#### 1.1 å»ºç«‹ Telegram Bot

```bash
# 1. åœ¨ Telegram ä¸­æ‰¾ @BotFather
# 2. ç™¼é€ /newbot
# 3. è¨­å®šåç¨±ï¼šSales AI Dev Monitor
# 4. å–å¾— Bot Token
# 5. è¨­å®šå‘½ä»¤åˆ—è¡¨ï¼š
/setcommands
status - æŸ¥è©¢ç•¶å‰é–‹ç™¼ç‹€æ…‹
task - ä¸‹é”æ–°ä»»å‹™
continue - ç¹¼çºŒç•¶å‰ä»»å‹™
stop - ä¸­æ–·ç•¶å‰ä»»å‹™
logs - æŸ¥çœ‹æœ€è¿‘æ—¥èªŒ
git - Git æ“ä½œ
deploy - éƒ¨ç½²
approve - å¯©æ ¸é€šé
reject - å¯©æ ¸æ‹’çµ•
```

#### 1.2 å»ºç«‹ Cloudflare Tunnel

```bash
# Mac ä¸Šå®‰è£ cloudflared
brew install cloudflare/cloudflare/cloudflared

# ç™»å…¥ Cloudflare
cloudflared tunnel login

# å»ºç«‹éš§é“
cloudflared tunnel create dev-monitor

# è¨˜éŒ„éš§é“ ID å’Œèªè­‰æª”æ¡ˆè·¯å¾‘
# ~/.cloudflared/<TUNNEL_ID>.json
```

#### 1.3 å°ˆæ¡ˆçµæ§‹

```
apps/
â”œâ”€â”€ telegram-bot/           # Telegram Bot (Cloudflare Workers)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts       # å…¥å£é»
â”‚   â”‚   â”œâ”€â”€ commands/      # æŒ‡ä»¤è™•ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ status.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ task.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ git.ts
â”‚   â”‚   â”‚   â””â”€â”€ deploy.ts
â”‚   â”‚   â”œâ”€â”€ notifications/ # é€šçŸ¥è™•ç†
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ telegram-client.ts
â”‚   â”‚       â”œâ”€â”€ auth.ts
â”‚   â”‚       â””â”€â”€ bridge-client.ts
â”‚   â”œâ”€â”€ wrangler.toml
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ dev-bridge/             # Local Bridge (Mac æœ¬åœ°æœå‹™)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts       # HTTP æœå‹™å…¥å£
â”‚   â”‚   â”œâ”€â”€ claude/        # Claude Code æ§åˆ¶
â”‚   â”‚   â”‚   â”œâ”€â”€ session.ts
â”‚   â”‚   â”‚   â””â”€â”€ executor.ts
â”‚   â”‚   â”œâ”€â”€ git/           # Git æ“ä½œ
â”‚   â”‚   â”‚   â””â”€â”€ commands.ts
â”‚   â”‚   â””â”€â”€ deploy/        # éƒ¨ç½²è…³æœ¬
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â””â”€â”€ package.json
â”‚
â””â”€â”€ hooks/                  # Claude Code Hooks
    â”œâ”€â”€ notify-telegram.sh  # é€šçŸ¥è…³æœ¬
    â””â”€â”€ config.json         # Hook é…ç½®
```

### Phase 2ï¼šTelegram Bot å¯¦ä½œï¼ˆé è¨ˆ 2-3 å¤©ï¼‰

#### 2.1 æ ¸å¿ƒ Bot çµæ§‹

```typescript
// apps/telegram-bot/src/index.ts
import { Hono } from "hono";

interface Env {
  TELEGRAM_BOT_TOKEN: string;
  TELEGRAM_WEBHOOK_SECRET: string;
  BRIDGE_URL: string;  // Cloudflare Tunnel URL
  BRIDGE_SECRET: string;
  AUTHORIZED_CHAT_IDS: string;  // é€—è™Ÿåˆ†éš”çš„æˆæ¬Š Chat ID
}

const app = new Hono<{ Bindings: Env }>();

// Webhook ç«¯é»
app.post("/webhook", async (c) => {
  // é©—è­‰ Secret Token
  const secret = c.req.header("X-Telegram-Bot-Api-Secret-Token");
  if (secret !== c.env.TELEGRAM_WEBHOOK_SECRET) {
    return c.json({ error: "Unauthorized" }, 401);
  }

  const update = await c.req.json();

  // é©—è­‰ Chat ID
  const chatId = update.message?.chat?.id || update.callback_query?.message?.chat?.id;
  const authorizedIds = c.env.AUTHORIZED_CHAT_IDS.split(",").map(Number);

  if (!authorizedIds.includes(chatId)) {
    // æœªæˆæ¬Šç”¨æˆ¶
    await sendMessage(c.env, chatId, "âŒ æ‚¨æœªè¢«æˆæ¬Šä½¿ç”¨æ­¤ Bot");
    return c.json({ ok: true });
  }

  // è™•ç†æ›´æ–°
  c.executionCtx.waitUntil(handleUpdate(update, c.env));

  return c.json({ ok: true });
});

export default app;
```

#### 2.2 æŒ‡ä»¤è™•ç†

```typescript
// apps/telegram-bot/src/commands/task.ts

export async function handleTaskCommand(
  text: string,
  chatId: number,
  env: Env
): Promise<void> {
  const taskDescription = text.replace("/task", "").trim();

  if (!taskDescription) {
    await sendMessage(env, chatId, "è«‹æä¾›ä»»å‹™æè¿°ï¼Œä¾‹å¦‚ï¼š`/task ä¿®å¾©ç™»å…¥é é¢çš„ bug`");
    return;
  }

  // ç™¼é€ç¢ºèªè¨Šæ¯
  const confirmMsg = await sendMessage(env, chatId,
    `ğŸ“ *æ”¶åˆ°ä»»å‹™*\n\n\`${escapeMarkdown(taskDescription)}\`\n\næ­£åœ¨æäº¤çµ¦ Claude Code...`,
    { parse_mode: "MarkdownV2" }
  );

  try {
    // å‘¼å« Local Bridge
    const response = await fetch(`${env.BRIDGE_URL}/api/task`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${env.BRIDGE_SECRET}`
      },
      body: JSON.stringify({ task: taskDescription })
    });

    if (response.ok) {
      const result = await response.json();
      await editMessage(env, chatId, confirmMsg.message_id,
        `âœ… *ä»»å‹™å·²æäº¤*\n\nå·¥ä½œéšæ®µ ID: \`${result.sessionId}\`\n\nä½¿ç”¨ /status æŸ¥çœ‹é€²åº¦`
      );
    } else {
      throw new Error(`Bridge error: ${response.status}`);
    }
  } catch (error) {
    await editMessage(env, chatId, confirmMsg.message_id,
      `âŒ *æäº¤å¤±æ•—*\n\n${error.message}`
    );
  }
}
```

### Phase 3ï¼šLocal Bridge å¯¦ä½œï¼ˆé è¨ˆ 2-3 å¤©ï¼‰

#### 3.1 HTTP æœå‹™

```typescript
// apps/dev-bridge/src/index.ts
import { Hono } from "hono";
import { spawn } from "child_process";

const app = new Hono();

// èªè­‰ä¸­ä»‹å±¤
app.use("/*", async (c, next) => {
  const auth = c.req.header("Authorization");
  if (auth !== `Bearer ${process.env.BRIDGE_SECRET}`) {
    return c.json({ error: "Unauthorized" }, 401);
  }
  await next();
});

// ä¸‹é”ä»»å‹™
app.post("/api/task", async (c) => {
  const { task } = await c.req.json();

  // ä½¿ç”¨ Claude Code CLI åŸ·è¡Œä»»å‹™
  const sessionId = await executeClaudeTask(task);

  return c.json({ ok: true, sessionId });
});

// æŸ¥è©¢ç‹€æ…‹
app.get("/api/status", async (c) => {
  const status = await getClaudeStatus();
  return c.json(status);
});

// ä¸­æ–·ä»»å‹™
app.post("/api/stop", async (c) => {
  await stopClaudeTask();
  return c.json({ ok: true });
});

// Git æ“ä½œ
app.post("/api/git", async (c) => {
  const { command, args } = await c.req.json();
  const result = await executeGitCommand(command, args);
  return c.json(result);
});

// éƒ¨ç½²
app.post("/api/deploy", async (c) => {
  const { environment } = await c.req.json();
  const result = await executeDeploy(environment);
  return c.json(result);
});

// æ¥æ”¶ Hook é€šçŸ¥ä¸¦è½‰ç™¼åˆ° Telegram
app.post("/api/hook-event", async (c) => {
  const event = await c.req.json();
  await forwardToTelegram(event);
  return c.json({ ok: true });
});

export default app;
```

#### 3.2 Claude Code æ§åˆ¶å™¨

```typescript
// apps/dev-bridge/src/claude/executor.ts
import { spawn, ChildProcess } from "child_process";

let currentProcess: ChildProcess | null = null;
let currentSessionId: string | null = null;

export async function executeClaudeTask(task: string): Promise<string> {
  // å¦‚æœæœ‰æ­£åœ¨åŸ·è¡Œçš„ä»»å‹™ï¼Œå…ˆåœæ­¢
  if (currentProcess) {
    await stopClaudeTask();
  }

  return new Promise((resolve, reject) => {
    // ä½¿ç”¨ --print æ¨¡å¼åŸ·è¡Œ
    currentProcess = spawn("claude", [
      "-p", task,
      "--output-format", "stream-json"
    ], {
      cwd: process.env.PROJECT_DIR || process.cwd(),
      env: { ...process.env }
    });

    let sessionId = "";

    currentProcess.stdout?.on("data", (data) => {
      try {
        const lines = data.toString().split("\n").filter(Boolean);
        for (const line of lines) {
          const json = JSON.parse(line);
          if (json.session_id) {
            sessionId = json.session_id;
          }
          // è½‰ç™¼äº‹ä»¶åˆ° Telegram
          forwardEventToTelegram(json);
        }
      } catch (e) {
        // å¿½ç•¥é JSON è¼¸å‡º
      }
    });

    currentProcess.stderr?.on("data", (data) => {
      forwardErrorToTelegram(data.toString());
    });

    currentProcess.on("close", (code) => {
      currentProcess = null;
      if (code === 0) {
        forwardCompletionToTelegram(sessionId);
      }
    });

    // ç­‰å¾…å–å¾— session ID
    setTimeout(() => {
      if (sessionId) {
        currentSessionId = sessionId;
        resolve(sessionId);
      } else {
        resolve("pending");
      }
    }, 2000);
  });
}

export async function stopClaudeTask(): Promise<void> {
  if (currentProcess) {
    currentProcess.kill("SIGINT");
    currentProcess = null;
  }
}

export async function getClaudeStatus(): Promise<object> {
  return {
    running: currentProcess !== null,
    sessionId: currentSessionId,
    projectDir: process.env.PROJECT_DIR
  };
}
```

### Phase 4ï¼šClaude Code Hooks è¨­å®šï¼ˆé è¨ˆ 0.5 å¤©ï¼‰

#### 4.1 Hook è…³æœ¬

```bash
#!/bin/bash
# ~/.claude/hooks/notify-telegram.sh

BRIDGE_URL="${BRIDGE_URL:-http://localhost:3100}"
BRIDGE_SECRET="${BRIDGE_SECRET:-your-secret}"

EVENT_TYPE="$1"
shift

# å¾ stdin è®€å– Claude Code å‚³å…¥çš„è³‡æ–™
INPUT=$(cat)

# ç™¼é€åˆ° Local Bridge
curl -s -X POST "${BRIDGE_URL}/api/hook-event" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ${BRIDGE_SECRET}" \
  -d "{
    \"eventType\": \"${EVENT_TYPE}\",
    \"data\": ${INPUT:-\"{}\"},
    \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
  }"
```

#### 4.2 Hook é…ç½®

```json
// ~/.claude/settings.json
{
  "hooks": {
    "SessionStart": [
      {
        "type": "command",
        "command": "~/.claude/hooks/notify-telegram.sh session_start"
      }
    ],
    "PostToolUse": [
      {
        "type": "command",
        "command": "~/.claude/hooks/notify-telegram.sh tool_complete",
        "matcher": ["Bash", "Write", "Edit", "Read"]
      }
    ],
    "Notification": [
      {
        "type": "command",
        "command": "~/.claude/hooks/notify-telegram.sh notification"
      }
    ]
  }
}
```

### Phase 5ï¼šCloudflare Tunnel é…ç½®ï¼ˆé è¨ˆ 0.5 å¤©ï¼‰

#### 5.1 Tunnel é…ç½®æª”

```yaml
# ~/.cloudflared/config.yml

tunnel: <YOUR_TUNNEL_ID>
credentials-file: ~/.cloudflared/<YOUR_TUNNEL_ID>.json

ingress:
  # Local Bridge API
  - hostname: dev-bridge.your-domain.com
    service: http://localhost:3100
    originRequest:
      noTLSVerify: true

  # é è¨­è¦å‰‡ï¼ˆå¿…é ˆï¼‰
  - service: http_status:404
```

#### 5.2 å•Ÿå‹•æœå‹™è…³æœ¬

```bash
#!/bin/bash
# ~/start-dev-monitor.sh

# å•Ÿå‹• Local Bridge
cd ~/projects/sales_ai_automation_v3/apps/dev-bridge
bun run dev &
BRIDGE_PID=$!

# å•Ÿå‹• Cloudflare Tunnel
cloudflared tunnel run dev-monitor &
TUNNEL_PID=$!

echo "Dev Monitor started!"
echo "Bridge PID: $BRIDGE_PID"
echo "Tunnel PID: $TUNNEL_PID"

# å„²å­˜ PID ä»¥ä¾¿ä¹‹å¾Œåœæ­¢
echo "$BRIDGE_PID" > ~/.dev-monitor-bridge.pid
echo "$TUNNEL_PID" > ~/.dev-monitor-tunnel.pid
```

---

## äº”ã€é€šçŸ¥è¨Šæ¯ç¯„ä¾‹

### é–‹ç™¼ç‹€æ…‹é€šçŸ¥

```
ğŸš€ *é–‹ç™¼å·²é–‹å§‹*

å°ˆæ¡ˆï¼šsales_ai_automation_v3
åˆ†æ”¯ï¼šfeature/telegram-bot
æ™‚é–“ï¼š2026-01-28 14:30

ä½¿ç”¨ /status æŸ¥çœ‹è©³æƒ…
```

### å·¥å…·åŸ·è¡Œé€šçŸ¥

```
âš™ï¸ *æ­£åœ¨åŸ·è¡Œ*

å·¥å…·ï¼šEdit
æª”æ¡ˆï¼šsrc/components/Button.tsx
æ“ä½œï¼šä¿®æ”¹æŒ‰éˆ•æ¨£å¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… *åŸ·è¡Œå®Œæˆ*

çµæœï¼šæˆåŠŸä¿®æ”¹ 3 è¡Œç¨‹å¼ç¢¼
è€—æ™‚ï¼š0.5 ç§’
```

### Git æ“ä½œé€šçŸ¥

```
ğŸ“¦ *Git Commit*

è¨Šæ¯ï¼šfeat: æ–°å¢ Telegram Bot æ•´åˆ
æª”æ¡ˆï¼š
  - apps/telegram-bot/src/index.ts (+120)
  - apps/telegram-bot/package.json (+15)

[æ¨é€åˆ°é ç«¯] [æŸ¥çœ‹å·®ç•°]
```

### éŒ¯èª¤é€šçŸ¥

```
âŒ *éŒ¯èª¤ç™¼ç”Ÿ*

å·¥å…·ï¼šBash
å‘½ä»¤ï¼šbun run build
éŒ¯èª¤ï¼š
```
Type error: Property 'foo' does not exist on type 'Bar'
```

[æŸ¥çœ‹å®Œæ•´æ—¥èªŒ] [é‡è©¦]
```

### å¯©æ ¸è«‹æ±‚

```
âš ï¸ *éœ€è¦å¯©æ ¸*

Claude æƒ³è¦åŸ·è¡Œä»¥ä¸‹æ“ä½œï¼š

```bash
git push origin main
```

é€™æœƒå°‡è®Šæ›´æ¨é€åˆ° main åˆ†æ”¯ã€‚

[âœ… æ‰¹å‡†] [âŒ æ‹’çµ•]
```

---

## å…­ã€å¯¦ä½œå„ªå…ˆé †åº

| éšæ®µ | å…§å®¹ | é ä¼°æ™‚é–“ | å„ªå…ˆç´š |
|------|------|----------|--------|
| 1 | Telegram Bot åŸºç¤ + ç™½åå–®èªè­‰ | 1 å¤© | P0 |
| 2 | Local Bridge HTTP API | 1 å¤© | P0 |
| 3 | Cloudflare Tunnel è¨­å®š | 0.5 å¤© | P0 |
| 4 | `/status` `/task` æŒ‡ä»¤ | 1 å¤© | P0 |
| 5 | Claude Code Hooks æ•´åˆ | 0.5 å¤© | P0 |
| 6 | å³æ™‚é€šçŸ¥æ¨é€ | 1 å¤© | P1 |
| 7 | Git æ“ä½œæŒ‡ä»¤ | 0.5 å¤© | P1 |
| 8 | Deploy æŒ‡ä»¤ | 0.5 å¤© | P1 |
| 9 | å¯©æ ¸æ©Ÿåˆ¶ï¼ˆapprove/rejectï¼‰ | 1 å¤© | P2 |
| 10 | Web Dashboardï¼ˆå¯é¸ï¼‰ | 2 å¤© | P3 |

**ç¸½é ä¼°æ™‚é–“**ï¼šç´„ 5-7 å€‹å·¥ä½œå¤©ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

---

## ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é …

1. **Bot Token ä¿è­·**ï¼šæ°¸é ä¸è¦å°‡ Bot Token æäº¤åˆ° Git
2. **Chat ID ç™½åå–®**ï¼šåªå…è¨±ä½ è‡ªå·±çš„ Telegram Chat ID
3. **Bridge Secret**ï¼šä½¿ç”¨å¼·éš¨æ©Ÿå¯†ç¢¼
4. **æ•æ„Ÿæ“ä½œç¢ºèª**ï¼šdeployã€push ç­‰æ“ä½œéœ€äºŒæ¬¡ç¢ºèª
5. **æ—¥èªŒè„«æ•**ï¼šé€šçŸ¥ä¸­ä¸è¦åŒ…å«å¯†ç¢¼ã€API Key ç­‰æ•æ„Ÿè³‡è¨Š
6. **Tunnel å­˜å–æ§åˆ¶**ï¼šè€ƒæ…®å•Ÿç”¨ Cloudflare Access é€²ä¸€æ­¥ä¿è­·

---

## å…«ã€å¾ŒçºŒæ“´å±•å¯èƒ½

1. **èªéŸ³æŒ‡ä»¤**ï¼šé€é Telegram èªéŸ³è¨Šæ¯ä¸‹é”æŒ‡ä»¤
2. **æˆªåœ–å›å‚³**ï¼šå°‡ VS Code ç•«é¢æˆªåœ–å‚³é€åˆ° Telegram
3. **å¤šå°ˆæ¡ˆæ”¯æ´**ï¼šåŒæ™‚ç›£æ§å¤šå€‹å°ˆæ¡ˆ
4. **åœ˜éšŠå”ä½œ**ï¼šå…è¨±å¤šäººç›£æ§åŒä¸€é–‹ç™¼ç’°å¢ƒ
5. **AI æ‘˜è¦**ï¼šè‡ªå‹•æ‘˜è¦é•·æ™‚é–“çš„é–‹ç™¼é€²åº¦

---

## ä¹ã€å¿«é€Ÿé–‹å§‹æª¢æŸ¥æ¸…å–®

- [ ] åœ¨ Telegram å»ºç«‹ Botï¼ˆ@BotFatherï¼‰
- [ ] å–å¾—ä½ çš„ Telegram Chat ID
- [ ] å®‰è£ Cloudflare Tunnel (`brew install cloudflared`)
- [ ] å»ºç«‹ Cloudflare å¸³è™Ÿä¸¦è¨­å®š Tunnel
- [ ] å»ºç«‹ `apps/telegram-bot` å°ˆæ¡ˆ
- [ ] å»ºç«‹ `apps/dev-bridge` å°ˆæ¡ˆ
- [ ] è¨­å®š Claude Code Hooks
- [ ] æ¸¬è©¦ç«¯åˆ°ç«¯æµç¨‹

---

*æ–‡ä»¶å»ºç«‹æ—¥æœŸï¼š2026-01-28*
*ç‰ˆæœ¬ï¼š1.0*
