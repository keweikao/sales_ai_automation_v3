# 多產品線支援開發指南 - 總覽與索引

> **目的**: 提供獨立的 Agent 執行指南,支援並行開發
> **版本**: v1.0 (已修正技術衝突)
> **最後更新**: 2026-01-19

---

## 📚 文件結構

本指南拆分為 7 個獨立文件,每個 Agent 可以專注閱讀自己的部分:

### 核心指南文件

| 檔案 | 適用對象 | 閱讀優先級 |
|------|---------|-----------|
| [00_總覽與索引.md](00_總覽與索引.md) | 所有人 | 🔴 必讀 |
| [01_Agent_A_基礎設施.md](01_Agent_A_基礎設施.md) | Agent A 開發者 | 🔴 必讀 |
| [02_Agent_B_SlackBot.md](02_Agent_B_SlackBot.md) | Agent B 開發者 | 🔴 必讀 |
| [03_Agent_C_MEDDIC提示詞.md](03_Agent_C_MEDDIC提示詞.md) | Agent C 開發者 | 🔴 必讀 |
| [04_Agent_D_API與Queue.md](04_Agent_D_API與Queue.md) | Agent D 開發者 | 🔴 必讀 |
| [05_Agent_E_Dashboard.md](05_Agent_E_Dashboard.md) | Agent E 開發者 | 🔴 必讀 |
| [06_整合測試與部署.md](06_整合測試與部署.md) | 測試/部署團隊 | 🔴 必讀 |

### 參考文件

- [影響評估報告](../20260119_多產品線開發影響評估報告.md) - 了解對現有系統的影響
- [修正版規劃](../20260119_修正版_多產品線支援實作計畫.md) - 詳細技術架構

---

## 🎯 快速開始

### 如果你是 Agent A 開發者

1. ✅ 閱讀本文件 (總覽)
2. ✅ 閱讀 [01_Agent_A_基礎設施.md](01_Agent_A_基礎設施.md)
3. ✅ 開始開發
4. ✅ 完成後執行文件中的「驗收檢查點」
5. ✅ 通過後通知其他 Agent

### 如果你是 Agent B/C 開發者

1. ✅ 閱讀本文件 (總覽)
2. ✅ 確認 Agent A 是否完成 (或使用 Mock)
3. ✅ 閱讀對應的 Agent 指南
4. ✅ 開始開發 (可與其他 Agent 並行)
5. ✅ 完成後執行驗收檢查點

### 如果你是測試/部署人員

1. ✅ 閱讀本文件 (總覽)
2. ✅ 閱讀 [06_整合測試與部署.md](06_整合測試與部署.md)
3. ✅ 等待所有 Agent 完成
4. ✅ 執行整合測試
5. ✅ 執行分階段部署

---

## 🏗️ 架構總覽

### 模組依賴關係

```
┌─────────────────┐
│   Agent A       │  ← 基礎設施（優先開始）
│ Config + DB     │
└────────┬────────┘
         │ 提供：ProductLineConfig, DB schema
         ├──────────────────┬──────────────────┐
         ▼                  ▼                  ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│   Agent B       │ │   Agent C       │ │   Agent D       │
│  Slack Bot      │ │  MEDDIC Prompt  │ │  API + Queue    │
└─────────────────┘ └─────────────────┘ └─────────────────┘
         │                  │                  │
         └──────────┬───────┴──────────────────┘
                    ▼
         ┌─────────────────┐
         │   Agent E       │
         │  Dashboard      │
         └─────────────────┘
```

### 並行開發時程

| 週次 | Agent A | Agent B | Agent C | Agent D | Agent E |
|------|---------|---------|---------|---------|---------|
| **W1** | 🔴 開發中 | 🔴 開發中 | 🟡 開發中 | ⏸️ 等待 | ⏸️ 等待 |
| **W2** | ✅ 完成 | ✅ 完成 | 🟡 開發中 | 🟡 開發中 | ⏸️ 等待 |
| **W3** | - | - | ✅ 完成 | 🟡 開發中 | 🟢 開發中 |
| **W4** | - | - | - | ✅ 完成 | ✅ 完成 |

**總時程**: 38-48 小時 (分散在 4 週)

---

## 🎯 核心設計原則

### 1. 向後相容 (最重要!)

**所有變更必須向後相容**:
- ✅ 新欄位使用 `DEFAULT 'ichef'`
- ✅ 新參數都是 `optional`
- ✅ 不傳參數 = 預設 'ichef'
- ✅ 現有功能完全不受影響

### 2. 配置驅動

**產品線特定邏輯從配置讀取**:
- ✅ 表單欄位 → `ProductLineConfig.formFields`
- ✅ 提示詞 → `ProductLineConfig.prompts`
- ✅ 話術情境 → `ProductLineConfig.talkTracks`

### 3. 可擴展

**新增第三個產品線僅需**:
- ✅ 新增配置文件 (1h)
- ✅ 撰寫提示詞 (2h)
- ✅ Seed 話術資料 (1h)
- **總計**: 3-4 小時

### 4. 關注點分離

**通用邏輯 vs 產品特定邏輯**:
- ✅ Shared prompts → `prompts/meddic/shared/`
- ✅ iCHEF prompts → `prompts/meddic/ichef/`
- ✅ Beauty prompts → `prompts/meddic/beauty/`

---

## ⚠️ 重要技術修正

> 原始規劃已根據專案實際架構修正

### 修正項目

1. **Migration 檔名**
   - ❌ 原: `20260116_add_product_line.sql`
   - ✅ 改: `0003_add_product_line.sql` (Drizzle ORM 格式)

2. **Migration 路徑**
   - ❌ 原: `/packages/db/migrations/`
   - ✅ 改: `/packages/db/src/migrations/`

3. **Prompts 編譯**
   - ⚠️ 專案使用編譯機制: `.md` → `prompts.generated.ts`
   - ✅ 需要更新 `build-prompts.ts` 腳本

4. **Orchestrator 參數**
   - ⚠️ 必須保留所有現有參數
   - ✅ `leadId`, `conversationId`, `salesRep`, `conversationDate` + `productLine`

5. **Package Import**
   - ✅ 使用 `@Sales_ai_automation_v3/` (大寫 S)

---

## 📋 開發檢查清單

### Agent A 完成後

- [ ] ✅ 通過驗收檢查點 1
- [ ] ✅ 通知 Agent B, C, D
- [ ] ✅ 提供 Mock 支援 (如果需要)

### Agent B 完成後

- [ ] ✅ 通過驗收檢查點 2A
- [ ] ✅ Slack Bot 向後相容測試通過

### Agent C 完成後

- [ ] ✅ 通過驗收檢查點 2B
- [ ] ✅ Prompts 編譯成功
- [ ] ✅ iCHEF 分析品質測試通過

### Agent D 完成後

- [ ] ✅ 通過驗收檢查點 3
- [ ] ✅ 端到端測試通過

### Agent E 完成後

- [ ] ✅ 通過驗收檢查點 4
- [ ] ✅ 美業話術資料完整

### 所有 Agent 完成後

- [ ] ✅ 執行整合測試 (見文件 06)
- [ ] ✅ 執行回歸測試
- [ ] ✅ 性能測試通過
- [ ] ✅ 準備部署

---

## 🚀 部署策略概覽

### 分階段部署 (安全策略)

**階段 1**: 基礎設施 (Week 1)
- 部署 Migration + Config
- 影響: 🟢 無

**階段 2**: 後端服務 (Week 2)
- 部署 API + Queue + Orchestrator
- 影響: 🟢 無 (向後相容)

**階段 3**: Slack Bot (Week 3)
- 部署 Slack Bot (不設定環境變數)
- 影響: 🟢 無

**階段 4**: 啟用美業 (Week 4)
- 設定環境變數 (只新 Channel)
- 部署 Dashboard
- 影響: 🟢 無 (只影響新 Channel)

詳見: [06_整合測試與部署.md](06_整合測試與部署.md)

---

## 📞 協作流程

### Agent 間溝通

**Agent A 完成時**:
```
通知: Agent B, C, D
訊息: "Agent A 已完成,ProductLineConfig 可用"
提供: Import 路徑, 使用範例
```

**Agent C 完成時**:
```
通知: Agent D
訊息: "PromptLoader 可用,請整合到 Orchestrator"
提供: API 文檔, 測試案例
```

### 問題回報

**遇到阻塞問題時**:
1. 記錄問題 (問題描述 + 預期行為)
2. 檢查是否是依賴問題 (等待其他 Agent)
3. 如果是技術問題,回報給技術負責人
4. 如果可以用 Mock 繼續,先用 Mock

---

## 📚 相關文件

### 專案文件
- [主要 README](../../README.md)
- [Setup 指南](../../README_SETUP.md)

### 多產品線相關
- [影響評估報告](../20260119_多產品線開發影響評估報告.md)
- [修正版規劃](../20260119_修正版_多產品線支援實作計畫.md)
- [原始規劃](../20260119_多產品線支援實作計畫_餐飲與美業分流架構設計.md)

---

## 🎯 成功標準

### 功能完整性
- ✅ 美業 Channel 可上傳音檔並填寫專屬表單
- ✅ 美業對話使用專屬 MEDDIC 提示詞分析
- ✅ 話術系統正確過濾產品線
- ✅ 儀表板可按產品線篩選
- ✅ **iCHEF 功能完全不受影響**

### 技術品質
- ✅ TypeScript 編譯無錯誤
- ✅ 測試覆蓋率 > 80%
- ✅ 所有單元測試通過
- ✅ 所有整合測試通過
- ✅ 所有回歸測試通過

### 性能要求
- ✅ 表單生成 < 100ms
- ✅ 產品線解析 < 10ms
- ✅ 提示詞載入 < 50ms
- ✅ 查詢時間增幅 < 10%

---

## 💡 常見問題

### Q: Agent A 還沒完成,我可以開始開發嗎?
A: 可以!使用 Mock 資料先開發,Agent A 完成後再替換。

### Q: 如何確保向後相容?
A: 每個 Agent 文件都有「向後相容性驗收」章節,必須全部通過。

### Q: 測試失敗怎麼辦?
A: 停止進入下一階段,修正問題後重新執行驗收檢查點。

### Q: 部署後發現問題怎麼辦?
A: 參考 [06_整合測試與部署.md](06_整合測試與部署.md) 的回滾計畫。

---

**準備好了嗎?** 選擇你的 Agent,開始開發! 🚀
