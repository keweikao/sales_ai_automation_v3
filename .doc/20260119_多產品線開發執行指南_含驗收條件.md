# å¤šç”¢å“ç·šæ”¯æ´é–‹ç™¼åŸ·è¡ŒæŒ‡å— (å«é©—æ”¶æ¢ä»¶)

> **ç›®çš„**: å°‡å½±éŸ¿è©•ä¼°å ±å‘Šçš„æ¢ä»¶æ•´åˆåˆ°é–‹ç™¼æµç¨‹ä¸­
> **ç­–ç•¥**: æ¯å€‹ Agent å®Œæˆå¾Œå¿…é ˆé€šéé©—æ”¶æ¢ä»¶æ‰èƒ½é€²å…¥ä¸‹ä¸€éšæ®µ

---

## é–‹ç™¼æµç¨‹ç¸½è¦½

```
Agent A (Config + DB)
    â†“ [é©—æ”¶æª¢æŸ¥é» 1]
Agent B (Slack Bot) + Agent C (Prompts)
    â†“ [é©—æ”¶æª¢æŸ¥é» 2]
Agent D (API + Queue)
    â†“ [é©—æ”¶æª¢æŸ¥é» 3]
Agent E (Dashboard)
    â†“ [é©—æ”¶æª¢æŸ¥é» 4]
æ•´åˆæ¸¬è©¦
    â†“ [æœ€çµ‚é©—æ”¶]
åˆ†éšæ®µéƒ¨ç½²
```

---

## Agent Aï¼šåŸºç¤è¨­æ–½èˆ‡æ ¸å¿ƒæœå‹™

### é–‹ç™¼ä»»å‹™

**é…ç½®ç³»çµ±** (4-5h)
- [ ] å‰µå»º `/packages/shared/src/product-configs/` ç›®éŒ„
- [ ] å¯¦ä½œ `types.ts` (å®Œæ•´ TypeScript ä»‹é¢å®šç¾©)
- [ ] å¯¦ä½œ `ichef.ts` (å¾ç¾æœ‰ç¡¬ç·¨ç¢¼é·ç§»)
- [ ] å¯¦ä½œ `beauty.ts` (ç¾æ¥­é…ç½®)
- [ ] å¯¦ä½œ `registry.ts` (é…ç½®è¨»å†Šèˆ‡æŸ¥è©¢)
- [ ] å¯¦ä½œ `index.ts` (çµ±ä¸€å°å‡º)
- [ ] æ›´æ–° `/packages/shared/package.json` exports

**è³‡æ–™åº«æ“´å±•** (3-4h)
- [ ] æ’°å¯« Migration: `/packages/db/src/migrations/0003_add_product_line.sql`
- [ ] æ›´æ–° Schema æ–‡ä»¶ (4 å€‹æª”æ¡ˆ)
- [ ] æ›´æ–° Migration metadata: `meta/_journal.json`

**æ¸¬è©¦** (1h)
- [ ] å–®å…ƒæ¸¬è©¦ï¼š`getProductConfig()`, `getAllProductLines()`
- [ ] é…ç½®çµæ§‹é©—è­‰

---

### âœ… é©—æ”¶æª¢æŸ¥é» 1 - Agent A å®Œæˆæ¨™æº–

#### ğŸ“‹ åŠŸèƒ½é©—æ”¶

**1. é…ç½®ç³»çµ±å¯ç”¨**
```bash
# æ¸¬è©¦ import
bun run -e "
import { getProductConfig, getAllProductLines } from '@Sales_ai_automation_v3/shared/product-configs';
const ichef = getProductConfig('ichef');
const beauty = getProductConfig('beauty');
const all = getAllProductLines();
console.log('iCHEF:', ichef.displayName);
console.log('Beauty:', beauty.displayName);
console.log('All:', all);
"
```
**é æœŸè¼¸å‡º**:
```
iCHEF: iCHEF POS ç³»çµ±
Beauty: ç¾æ¥­ç®¡ç†ç³»çµ±
All: [ 'ichef', 'beauty' ]
```

**2. Migration åŸ·è¡ŒæˆåŠŸ**
```bash
# åŸ·è¡Œ Migration
bun run db:migrate

# é©—è­‰æ¬„ä½å­˜åœ¨
psql $DATABASE_URL -c "SELECT column_name, column_default FROM information_schema.columns WHERE table_name IN ('opportunities', 'conversations', 'talk_tracks', 'meddic_analyses') AND column_name = 'product_line';"
```
**é æœŸçµæœ**: 4 å€‹è¡¨æ ¼éƒ½æœ‰ `product_line` æ¬„ä½,é è¨­å€¼ç‚º 'ichef'

**3. ç¾æœ‰è³‡æ–™å®Œæ•´æ€§**
```sql
-- æª¢æŸ¥ç¾æœ‰è³‡æ–™æ˜¯å¦è‡ªå‹•è¨­å®šç‚º 'ichef'
SELECT
  (SELECT COUNT(*) FROM opportunities WHERE product_line = 'ichef') as opp_count,
  (SELECT COUNT(*) FROM conversations WHERE product_line = 'ichef') as conv_count,
  (SELECT COUNT(*) FROM talk_tracks WHERE product_line = 'ichef') as tt_count,
  (SELECT COUNT(*) FROM meddic_analyses WHERE product_line = 'ichef') as ma_count;
```
**é æœŸçµæœ**: æ‰€æœ‰ç¾æœ‰è³‡æ–™çš„ count éƒ½æ‡‰è©² > 0 (å¦‚æœæœ‰è³‡æ–™çš„è©±)

#### ğŸ§ª å“è³ªé©—æ”¶

- [ ] TypeScript ç·¨è­¯ç„¡éŒ¯èª¤: `bun run check-types`
- [ ] å–®å…ƒæ¸¬è©¦é€šé: `bun run test packages/shared`
- [ ] Linting é€šé: `bun x ultracite check`
- [ ] æ¸¬è©¦è¦†è“‹ç‡ > 80%

#### âš ï¸ å‘å¾Œç›¸å®¹æ€§é©—æ”¶

**æ¸¬è©¦ 1: ç¾æœ‰ API å‘¼å«ä¸å—å½±éŸ¿**
```typescript
// æ¸¬è©¦ä¸ä½¿ç”¨ product_line çš„æŸ¥è©¢
const opportunities = await db.query.opportunities.findMany({
  where: eq(opportunities.userId, userId)
  // ä¸éæ¿¾ product_line
});
// æ‡‰è©²å›å‚³æ‰€æœ‰è³‡æ–™ (åŒ…å« product_line='ichef' çš„è³‡æ–™)
```
**çµæœ**: âœ… é€šé

**æ¸¬è©¦ 2: Insert ä¸éœ€è¦æŒ‡å®š product_line**
```typescript
// ä¸æŒ‡å®š product_line
const newOpp = await db.insert(opportunities).values({
  id: randomUUID(),
  userId: 'test-user',
  customerNumber: '202601-TEST',
  companyName: 'Test Company'
  // ä¸æŒ‡å®š product_line
}).returning();

console.log(newOpp[0].productLine); // æ‡‰è©²æ˜¯ 'ichef'
```
**çµæœ**: âœ… é€šé

#### ğŸ“Š æ€§èƒ½é©—æ”¶

```sql
-- æª¢æŸ¥ Index æ˜¯å¦å»ºç«‹
SELECT indexname, indexdef FROM pg_indexes
WHERE tablename IN ('opportunities', 'conversations', 'talk_tracks', 'meddic_analyses')
AND indexname LIKE '%product_line%';
```
**é æœŸçµæœ**: 4 å€‹ Index éƒ½å­˜åœ¨

**æŸ¥è©¢æ€§èƒ½æ¸¬è©¦**:
```sql
EXPLAIN ANALYZE SELECT * FROM conversations WHERE product_line = 'ichef';
```
**é æœŸçµæœ**: ä½¿ç”¨ Index Scan,åŸ·è¡Œæ™‚é–“ < 50ms

---

### ğŸš« ä¸é€šéæ¨™æº– (å¿…é ˆä¿®æ­£)

å¦‚æœä»¥ä¸‹ä»»ä¸€æ¢ä»¶ä¸ç¬¦åˆ,**å¿…é ˆä¿®æ­£å¾Œæ‰èƒ½é€²å…¥ä¸‹ä¸€éšæ®µ**:

- âŒ Migration åŸ·è¡Œå¤±æ•—
- âŒ TypeScript ç·¨è­¯éŒ¯èª¤
- âŒ å–®å…ƒæ¸¬è©¦å¤±æ•—
- âŒ ç¾æœ‰è³‡æ–™ product_line ä¸æ˜¯ 'ichef'
- âŒ Index æœªå»ºç«‹
- âŒ Package import å¤±æ•—

---

## Agent Bï¼šSlack Bot å‹•æ…‹è¡¨å–®ç³»çµ±

### é–‹ç™¼ä»»å‹™

**Channel è§£æ** (2h)
- [ ] å‰µå»º `product-line-resolver.ts`
- [ ] å¯¦ä½œç’°å¢ƒè®Šæ•¸è§£æé‚è¼¯
- [ ] Fallback æ©Ÿåˆ¶

**è¡¨å–®ç”Ÿæˆå™¨** (4-5h)
- [ ] å‰µå»º `form-builder.ts`
- [ ] å‹•æ…‹è¡¨å–®ç”Ÿæˆé‚è¼¯
- [ ] è¡¨å–®è§£æé‚è¼¯

**File Upload æ•´åˆ** (2-3h)
- [ ] ä¿®æ”¹ `file.ts`
- [ ] æ›´æ–° `types.ts`

---

### âœ… é©—æ”¶æª¢æŸ¥é» 2A - Agent B å®Œæˆæ¨™æº–

#### ğŸ“‹ åŠŸèƒ½é©—æ”¶

**æ¸¬è©¦ 1: Channel è§£æ (æœªè¨­å®šç’°å¢ƒè®Šæ•¸)**
```typescript
// ä¸è¨­å®š PRODUCT_LINE_CHANNELS
const productLine = resolveProductLine('C123456', env);
console.log(productLine); // æ‡‰è©²æ˜¯ 'ichef' (fallback)
```
**çµæœ**: âœ… å¿…é ˆè¿”å› 'ichef'

**æ¸¬è©¦ 2: Channel è§£æ (å·²è¨­å®šç’°å¢ƒè®Šæ•¸)**
```typescript
// è¨­å®š PRODUCT_LINE_CHANNELS='{"C12345":"ichef","C67890":"beauty"}'
const pl1 = resolveProductLine('C12345', env);
const pl2 = resolveProductLine('C67890', env);
const pl3 = resolveProductLine('C99999', env); // æœªé…ç½®çš„ Channel
console.log(pl1, pl2, pl3);
```
**é æœŸè¼¸å‡º**: `ichef beauty ichef`

**æ¸¬è©¦ 3: è¡¨å–®ç”Ÿæˆ (iCHEF)**
```typescript
const modal = buildAudioUploadModal(pendingFile, 'ichef');
// æª¢æŸ¥è¡¨å–®æ¬„ä½
const fields = modal.blocks.filter(b => b.type === 'input');
const fieldIds = fields.map(f => f.block_id);
console.log(fieldIds);
```
**é æœŸåŒ…å«**: `store_type`, `service_type`, `current_pos`

**æ¸¬è©¦ 4: è¡¨å–®ç”Ÿæˆ (Beauty)**
```typescript
const modal = buildAudioUploadModal(pendingFile, 'beauty');
const fields = modal.blocks.filter(b => b.type === 'input');
const fieldIds = fields.map(f => f.block_id);
console.log(fieldIds);
```
**é æœŸåŒ…å«**: `store_type`, `staff_count`, `current_beauty_system`

#### âš ï¸ å‘å¾Œç›¸å®¹æ€§é©—æ”¶ (é—œéµ!)

**æ¸¬è©¦å ´æ™¯ 1: æœªè¨­å®šç’°å¢ƒè®Šæ•¸ (æœ€é‡è¦)**
```bash
# å®Œå…¨ä¸è¨­å®š PRODUCT_LINE_CHANNELS
# åœ¨æ¸¬è©¦ç’°å¢ƒä¸Šå‚³éŸ³æª”
```
**é æœŸè¡Œç‚º**:
- âœ… é¡¯ç¤º iCHEF è¡¨å–® (åº—å‹ã€ç‡Ÿé‹å‹æ…‹ã€ç¾æœ‰POS)
- âœ… æäº¤å¾Œ metadata.productLine = 'ichef'
- âœ… èˆ‡ç¾æœ‰æµç¨‹å®Œå…¨ç›¸åŒ

**æ¸¬è©¦å ´æ™¯ 2: ç¾æœ‰ Channel è¡Œç‚ºä¸è®Š**
```bash
# åœ¨ç›®å‰ä½¿ç”¨çš„ iCHEF Channel ä¸Šå‚³éŸ³æª”
```
**é æœŸè¡Œç‚º**:
- âœ… è¡¨å–®èˆ‡ä¹‹å‰å®Œå…¨ç›¸åŒ
- âœ… ä½¿ç”¨è€…ç„¡æ„ŸçŸ¥è®ŠåŒ–

#### ğŸ§ª å“è³ªé©—æ”¶

- [ ] TypeScript ç·¨è­¯ç„¡éŒ¯èª¤
- [ ] å–®å…ƒæ¸¬è©¦é€šé
- [ ] Linting é€šé
- [ ] å¯¦éš› Slack æ¸¬è©¦é€šé

---

## Agent Cï¼šMEDDIC æç¤ºè©ç³»çµ±

### é–‹ç™¼ä»»å‹™

**Prompts é‡çµ„** (5-6h)
- [ ] å‰µå»ºç›®éŒ„çµæ§‹ (`shared/`, `ichef/`, `beauty/`)
- [ ] é·ç§»ç¾æœ‰ prompts
- [ ] æ’°å¯«ç¾æ¥­ prompts

**ç·¨è­¯è…³æœ¬æ›´æ–°** (2-3h)
- [ ] é‡å¯« `build-prompts.ts`
- [ ] æ¸¬è©¦ç·¨è­¯

**Prompt Loader** (3-4h)
- [ ] å¯¦ä½œ `PromptLoader` é¡åˆ¥
- [ ] å¿«å–æ©Ÿåˆ¶

**Orchestrator æ•´åˆ** (2-3h)
- [ ] æ›´æ–° `MeddicOrchestrator`
- [ ] æ•´åˆ PromptLoader

---

### âœ… é©—æ”¶æª¢æŸ¥é» 2B - Agent C å®Œæˆæ¨™æº–

#### ğŸ“‹ åŠŸèƒ½é©—æ”¶

**æ¸¬è©¦ 1: Prompts ç·¨è­¯æˆåŠŸ**
```bash
# åŸ·è¡Œç·¨è­¯è…³æœ¬
bun run /packages/services/scripts/build-prompts.ts

# æª¢æŸ¥ç”Ÿæˆæª”æ¡ˆ
cat /packages/services/src/llm/prompts.generated.ts | grep "export const"
```
**é æœŸè¼¸å‡º**:
```typescript
export const ichefGlobalContext = ...
export const ichefProductContext = ...
export const beautyGlobalContext = ...
export const beautyProductContext = ...
export const sharedAgent1Context = ...
export const sharedAgent2Buyer = ...
// ... ç­‰
```

**æ¸¬è©¦ 2: PromptLoader æ­£ç¢ºè¼‰å…¥**
```typescript
import { PromptLoader } from './prompt-loader';

const ichefGlobal = PromptLoader.loadGlobalContext('ichef');
const beautyGlobal = PromptLoader.loadGlobalContext('beauty');

console.log('iCHEF contains "iCHEF POS":', ichefGlobal.includes('iCHEF'));
console.log('Beauty contains "ç¾æ¥­":', beautyGlobal.includes('ç¾æ¥­'));
```
**çµæœ**: å…©å€‹éƒ½æ‡‰è©²æ˜¯ `true`

**æ¸¬è©¦ 3: Orchestrator å‘å¾Œç›¸å®¹ (é—œéµ!)**
```typescript
// ä¸å‚³ productLine
const orchestrator = new MeddicOrchestrator(geminiClient);
const result = await orchestrator.analyze(mockTranscript, {
  leadId: 'lead-123',
  conversationId: 'conv-456',
  salesRep: 'John',
  conversationDate: new Date()
  // ä¸å‚³ productLine
});

// æª¢æŸ¥ä½¿ç”¨çš„ prompt
console.log('Used iCHEF prompts:', result.usedPrompts.includes('ichef'));
```
**çµæœ**: âœ… å¿…é ˆä½¿ç”¨ iCHEF prompts

#### âš ï¸ å‘å¾Œç›¸å®¹æ€§é©—æ”¶ (æœ€é—œéµ!)

**æ¸¬è©¦å ´æ™¯: iCHEF Prompts å…§å®¹ä¸€è‡´æ€§**
```typescript
// æ¯”è¼ƒæ–°èˆŠ prompts å…§å®¹
const oldGlobalContext = readFileSync('prompts/meddic/global-context.md.backup', 'utf-8');
const newGlobalContext = PromptLoader.loadGlobalContext('ichef');

// æ ¸å¿ƒå…§å®¹æ‡‰è©²ç›¸åŒ (å»é™¤ç©ºç™½å·®ç•°)
const normalize = (s) => s.replace(/\s+/g, ' ').trim();
console.log('Content match:', normalize(oldGlobalContext) === normalize(newGlobalContext));
```
**çµæœ**: âœ… å…§å®¹å¿…é ˆä¸€è‡´ (é™¤äº†æ ¼å¼åŒ–å·®ç•°)

**æ¸¬è©¦å ´æ™¯: åˆ†æå“è³ªä¸ä¸‹é™**
```typescript
// ä½¿ç”¨ç›¸åŒçš„æ¸¬è©¦éŸ³æª”
const testTranscript = loadTestTranscript('test-ichef-demo.json');

// æ–°ç‰ˆæœ¬åˆ†æ
const newResult = await orchestrator.analyze(testTranscript, metadata);

// æ¯”è¼ƒé—œéµæŒ‡æ¨™
console.log('Overall Score:', newResult.overallScore);
console.log('MEDDIC Dimensions:', newResult.meddicScores);

// èˆ‡ä¹‹å‰çš„åŸºæº–æ¯”è¼ƒ
const baseline = loadBaseline('test-ichef-demo-baseline.json');
console.log('Score difference:', Math.abs(newResult.overallScore - baseline.overallScore));
```
**çµæœ**: âœ… åˆ†æ•¸å·®ç•° < 5 åˆ† (å¯æ¥å—ç¯„åœ)

#### ğŸ§ª å“è³ªé©—æ”¶

- [ ] TypeScript ç·¨è­¯ç„¡éŒ¯èª¤
- [ ] å–®å…ƒæ¸¬è©¦é€šé (Loader, Orchestrator)
- [ ] Prompts ç·¨è­¯ç„¡éŒ¯èª¤
- [ ] iCHEF åˆ†æå“è³ªæ¸¬è©¦é€šé (èˆ‡åŸºæº–æ¯”è¼ƒ)
- [ ] Beauty åˆ†æå“è³ªæ¸¬è©¦é€šé (æ–°åŠŸèƒ½)

---

## Agent Dï¼šAPI + Queue Worker æ•´åˆ

### é–‹ç™¼ä»»å‹™

**API Router æ›´æ–°** (3-4h)
- [ ] ä¿®æ”¹ `conversation.ts`
- [ ] ä¿®æ”¹ `talk-track.ts`
- [ ] ä¿®æ”¹ `analytics.ts`

**Queue Worker æ•´åˆ** (2-3h)
- [ ] ä¿®æ”¹ `index.ts`
- [ ] æ›´æ–° Slack é€šçŸ¥

---

### âœ… é©—æ”¶æª¢æŸ¥é» 3 - Agent D å®Œæˆæ¨™æº–

#### ğŸ“‹ åŠŸèƒ½é©—æ”¶

**æ¸¬è©¦ 1: API å‘å¾Œç›¸å®¹ (é—œéµ!)**
```typescript
// ä¸å‚³ productLine
const result = await api.conversation.upload({
  opportunityId: 'opp-123',
  audioBase64: testAudioBase64,
  title: 'Test Demo',
  type: 'demo',
  metadata: {
    duration: 300,
    format: 'mp3'
    // ä¸å‚³ productLine
  }
});

// æª¢æŸ¥ DB
const conversation = await db.query.conversations.findFirst({
  where: eq(conversations.id, result.conversationId)
});

console.log('Product Line:', conversation.productLine);
```
**çµæœ**: âœ… å¿…é ˆæ˜¯ 'ichef'

**æ¸¬è©¦ 2: Talk Track éæ¿¾**
```typescript
// ä¸å‚³ productLine (é è¨­è¡Œç‚º)
const tracks1 = await api.talkTrack.search({ keyword: 'å“¡å·¥' });
console.log('Default search:', tracks1.length);

// æ˜ç¢ºæŒ‡å®š ichef
const tracks2 = await api.talkTrack.search({ keyword: 'å“¡å·¥', productLine: 'ichef' });
console.log('iCHEF search:', tracks2.length);

// æ˜ç¢ºæŒ‡å®š beauty
const tracks3 = await api.talkTrack.search({ keyword: 'å“¡å·¥', productLine: 'beauty' });
console.log('Beauty search:', tracks3.length);
```
**çµæœ**: tracks1 å’Œ tracks2 æ‡‰è©²ç›¸åŒ (éƒ½æ˜¯ iCHEF)

**æ¸¬è©¦ 3: Queue Worker å®Œæ•´æµç¨‹**
```typescript
// æ¨¡æ“¬ Queue è¨Šæ¯
const message = {
  conversationId: 'conv-test',
  audioUrl: 's3://...',
  opportunityId: 'opp-123',
  caseNumber: '202601-IC001',
  metadata: { fileName: 'test.mp3', fileSize: 1024000 }
  // ä¸å‚³ productLine
};

// è™•ç†è¨Šæ¯
await queueWorker.handleMessage(message);

// æª¢æŸ¥çµæœ
const conversation = await db.query.conversations.findFirst({
  where: eq(conversations.id, 'conv-test')
});

console.log('Status:', conversation.status);
console.log('Product Line:', conversation.productLine);
console.log('Has Analysis:', !!conversation.meddicAnalysis);
```
**é æœŸçµæœ**:
- Status: 'completed'
- Product Line: 'ichef'
- Has Analysis: true

#### âš ï¸ å‘å¾Œç›¸å®¹æ€§é©—æ”¶ (æœ€é—œéµ!)

**ç«¯åˆ°ç«¯æ¸¬è©¦å ´æ™¯: å®Œæ•´ iCHEF æµç¨‹**
```bash
# 1. ä¸Šå‚³éŸ³æª” (ä¸å‚³ productLine)
curl -X POST /api/conversation/upload \
  -H "Content-Type: application/json" \
  -d '{"opportunityId":"opp-123","audioBase64":"..."}'

# 2. ç­‰å¾… Queue Worker è™•ç†
sleep 60

# 3. æª¢æŸ¥çµæœ
curl /api/conversation/get?conversationId=conv-xxx
```
**é æœŸçµæœ**:
- âœ… product_line = 'ichef'
- âœ… è½‰éŒ„æˆåŠŸ
- âœ… MEDDIC åˆ†ææˆåŠŸ
- âœ… åˆ†æå“è³ªèˆ‡ä¹‹å‰ç›¸åŒ

#### ğŸ“Š æ€§èƒ½é©—æ”¶

**API å›æ‡‰æ™‚é–“æ¸¬è©¦**:
```bash
# æ¸¬è©¦ 100 æ¬¡ API å‘¼å«
for i in {1..100}; do
  curl -w "%{time_total}\n" -o /dev/null -s /api/conversation/list
done | awk '{sum+=$1; count++} END {print "Average:", sum/count}'
```
**çµæœ**: âœ… å¹³å‡æ™‚é–“å¢åŠ  < 10%

**Queue è™•ç†æ™‚é–“æ¸¬è©¦**:
```bash
# ç›£æ§ Queue Worker logs
grep "Processing conversation" logs.txt | awk '{print $NF}' | awk '{sum+=$1; count++} END {print "Average:", sum/count}'
```
**çµæœ**: âœ… å¹³å‡è™•ç†æ™‚é–“å¢åŠ  < 10%

---

## Agent Eï¼šå„€è¡¨æ¿èˆ‡è©±è¡“è³‡æ–™

### é–‹ç™¼ä»»å‹™

**å‰ç«¯ UI** (2-3h)
- [ ] å‰µå»º `ProductLineSwitcher.tsx`
- [ ] ä¿®æ”¹ `dashboard.tsx`

**è©±è¡“è³‡æ–™** (1-2h)
- [ ] å‰µå»º seed è…³æœ¬
- [ ] åŸ·è¡Œ seed

---

### âœ… é©—æ”¶æª¢æŸ¥é» 4 - Agent E å®Œæˆæ¨™æº–

#### ğŸ“‹ åŠŸèƒ½é©—æ”¶

**æ¸¬è©¦ 1: ç”¢å“ç·šåˆ‡æ›å™¨**
```typescript
// æ¸²æŸ“æ¸¬è©¦
render(<ProductLineSwitcher value="all" onChange={mockOnChange} />);
const select = screen.getByRole('combobox');

// æª¢æŸ¥é¸é …
fireEvent.click(select);
const options = screen.getAllByRole('option');
console.log('Options:', options.map(o => o.textContent));
```
**é æœŸé¸é …**: `['æ‰€æœ‰ç”¢å“ç·š', 'iCHEF é¤é£²', 'ç¾æ¥­ç³»çµ±']`

**æ¸¬è©¦ 2: Dashboard éæ¿¾**
```typescript
// æ¸¬è©¦éæ¿¾åŠŸèƒ½
const { rerender } = render(<Dashboard />);

// é¸æ“‡ iCHEF
fireEvent.change(screen.getByRole('combobox'), { target: { value: 'ichef' } });
await waitFor(() => {
  const conversations = screen.getAllByTestId('conversation-item');
  // æ‰€æœ‰é …ç›®éƒ½æ‡‰è©²æ˜¯ iCHEF
  conversations.forEach(conv => {
    expect(conv).toHaveAttribute('data-product-line', 'ichef');
  });
});
```

**æ¸¬è©¦ 3: ç¾æ¥­è©±è¡“è³‡æ–™**
```sql
SELECT COUNT(*), situation FROM talk_tracks
WHERE product_line = 'beauty'
GROUP BY situation;
```
**é æœŸçµæœ**: 8 ç¨®æƒ…å¢ƒ,æ¯ç¨®è‡³å°‘ 3 ç­†è©±è¡“

---

## æ•´åˆæ¸¬è©¦éšæ®µ

### âœ… æœ€çµ‚é©—æ”¶æ¢ä»¶

#### ğŸ¯ ç«¯åˆ°ç«¯å ´æ™¯æ¸¬è©¦

**å ´æ™¯ 1: iCHEF å®Œæ•´æµç¨‹ (å‘å¾Œç›¸å®¹é©—è­‰)**
```
æ­¥é©Ÿ:
1. åœ¨ç¾æœ‰ iCHEF Channel ä¸Šå‚³éŸ³æª”
2. å¡«å¯«è¡¨å–® (å’–å•¡å»³ã€å…§ç”¨ç‚ºä¸»ã€iCHEFèˆŠç‰ˆ)
3. ç­‰å¾…è™•ç†å®Œæˆ

é©—æ”¶æ¨™æº–:
âœ… è¡¨å–®èˆ‡ä¹‹å‰å®Œå…¨ç›¸åŒ
âœ… DB: conversation.product_line = 'ichef'
âœ… MEDDIC åˆ†æå“è³ª >= åŸºæº– (èª¤å·® < 5%)
âœ… Slack é€šçŸ¥æ­£å¸¸
âœ… Dashboard æ­£ç¢ºé¡¯ç¤º
âœ… ä½¿ç”¨è€…ç„¡æ„ŸçŸ¥å·®ç•°
```

**å ´æ™¯ 2: Beauty å®Œæ•´æµç¨‹ (æ–°åŠŸèƒ½é©—è­‰)**
```
æ­¥é©Ÿ:
1. è¨­å®š PRODUCT_LINE_CHANNELS (æ–°å¢ Beauty Channel)
2. åœ¨ Beauty Channel ä¸Šå‚³éŸ³æª”
3. å¡«å¯«è¡¨å–® (ç¾é«®æ²™é¾ã€4-10äººã€Excel)
4. ç­‰å¾…è™•ç†å®Œæˆ

é©—æ”¶æ¨™æº–:
âœ… é¡¯ç¤ºç¾æ¥­å°ˆå±¬è¡¨å–®
âœ… DB: conversation.product_line = 'beauty'
âœ… MEDDIC åˆ†æåŒ…å«ç¾æ¥­ç‰¹å®šæ´å¯Ÿ
âœ… Slack é€šçŸ¥æ¨™è¨»ã€Œç¾æ¥­åˆ†æå®Œæˆã€
âœ… Dashboard å¯éæ¿¾é¡¯ç¤º
```

**å ´æ™¯ 3: è³‡æ–™éš”é›¢é©—è­‰**
```
æ­¥é©Ÿ:
1. å‰µå»º 5 ç­† iCHEF conversations
2. å‰µå»º 5 ç­† Beauty conversations
3. æ¸¬è©¦å„ç¨®æŸ¥è©¢

é©—æ”¶æ¨™æº–:
âœ… æŸ¥è©¢ productLine='ichef' â†’ åªè¿”å› 5 ç­†
âœ… æŸ¥è©¢ productLine='beauty' â†’ åªè¿”å› 5 ç­†
âœ… ä¸éæ¿¾ â†’ è¿”å› 10 ç­†
âœ… Dashboard åˆ‡æ›æ­£ç¢ºéæ¿¾
```

#### ğŸ“Š æ€§èƒ½é©—æ”¶åŸºæº–

åŸ·è¡Œä»¥ä¸‹æ¸¬è©¦,çµæœå¿…é ˆç¬¦åˆåŸºæº–:

```bash
# 1. è¡¨å–®ç”Ÿæˆæ™‚é–“
time buildAudioUploadModal(pendingFile, 'ichef')
```
**åŸºæº–**: < 100ms

```bash
# 2. ç”¢å“ç·šè§£ææ™‚é–“
time resolveProductLine(channelId, env)
```
**åŸºæº–**: < 10ms

```bash
# 3. Prompts è¼‰å…¥æ™‚é–“ (å«å¿«å–)
time PromptLoader.loadGlobalContext('ichef')
```
**åŸºæº–**: < 50ms

```bash
# 4. è³‡æ–™åº«æŸ¥è©¢æ™‚é–“
EXPLAIN ANALYZE SELECT * FROM conversations WHERE product_line = 'ichef' LIMIT 100;
```
**åŸºæº–**: < 50ms

```bash
# 5. å®Œæ•´åˆ†ææ™‚é–“ (Queue Worker)
# ç›£æ§ logs: å¾æ¥æ”¶è¨Šæ¯åˆ°å®Œæˆçš„æ™‚é–“
```
**åŸºæº–**: å¢å¹… < 10%

#### ğŸ§ª å›æ­¸æ¸¬è©¦æ¸…å–® (å¿…é ˆå…¨éƒ¨é€šé)

**è³‡æ–™åº«æ¸¬è©¦**
- [ ] Migration åŸ·è¡ŒæˆåŠŸ,ç„¡éŒ¯èª¤
- [ ] æ‰€æœ‰ç¾æœ‰è³‡æ–™ `product_line = 'ichef'`
- [ ] Index æ­£ç¢ºå»ºç«‹,æŸ¥è©¢ä½¿ç”¨ Index
- [ ] æŸ¥è©¢æ€§èƒ½ç„¡ä¸‹é™ (< 10% å·®ç•°)

**API æ¸¬è©¦**
- [ ] ä¸å‚³ `productLine` â†’ é è¨­ 'ichef'
- [ ] ä¸Šå‚³éŸ³æª”ä¸å‚³ `productLine` â†’ DB ä¸­ç‚º 'ichef'
- [ ] åˆ—è¡¨æŸ¥è©¢ä¸å‚³ `productLine` â†’ å›å‚³æ‰€æœ‰è³‡æ–™
- [ ] API å›æ‡‰æ™‚é–“ç„¡æ˜é¡¯å¢åŠ  (< 10%)

**MEDDIC åˆ†ææ¸¬è©¦**
- [ ] ä½¿ç”¨æ¸¬è©¦éŸ³æª”,åˆ†æçµæœèˆ‡åŸºæº–æ¯”è¼ƒ
- [ ] åˆ†æ•¸å·®ç•° < 5 åˆ†
- [ ] é—œéµç¶­åº¦è­˜åˆ¥ä¸€è‡´
- [ ] åˆ†ææ™‚é–“ç„¡æ˜é¡¯å¢åŠ 

**Slack Bot æ¸¬è©¦**
- [ ] æœªè¨­å®šç’°å¢ƒè®Šæ•¸ â†’ æ‰€æœ‰ Channel ä½¿ç”¨ iCHEF
- [ ] ç¾æœ‰ Channel ä¸Šå‚³ â†’ è¡¨å–®ç›¸åŒ
- [ ] è¡¨å–®æäº¤ â†’ product_line æ­£ç¢º
- [ ] Slack é€šçŸ¥æ­£å¸¸

**Queue Worker æ¸¬è©¦**
- [ ] è™•ç†ç¾æœ‰æ ¼å¼è¨Šæ¯æ­£å¸¸
- [ ] è½‰éŒ„æˆåŠŸ
- [ ] MEDDIC åˆ†ææˆåŠŸ
- [ ] DB æ›´æ–°æ­£ç¢º
- [ ] Slack é€šçŸ¥æˆåŠŸ

**ç«¯åˆ°ç«¯æ¸¬è©¦**
- [ ] å®Œæ•´ iCHEF æµç¨‹: ä¸Šå‚³ â†’ è½‰éŒ„ â†’ åˆ†æ â†’ é€šçŸ¥
- [ ] çµæœèˆ‡ä¹‹å‰ç‰ˆæœ¬ä¸€è‡´
- [ ] ä½¿ç”¨è€…é«”é©—ç„¡è®ŠåŒ–

---

## éƒ¨ç½²å‰æœ€çµ‚æª¢æŸ¥æ¸…å–®

### âœ… å¿…é ˆå®Œæˆçš„é …ç›®

**ç¨‹å¼ç¢¼å“è³ª**
- [ ] æ‰€æœ‰ TypeScript ç·¨è­¯ç„¡éŒ¯èª¤
- [ ] æ‰€æœ‰ Linting é€šé (`bun x ultracite check`)
- [ ] æ¸¬è©¦è¦†è“‹ç‡ > 80%
- [ ] æ‰€æœ‰å–®å…ƒæ¸¬è©¦é€šé
- [ ] æ‰€æœ‰æ•´åˆæ¸¬è©¦é€šé
- [ ] æ‰€æœ‰å›æ­¸æ¸¬è©¦é€šé

**å‘å¾Œç›¸å®¹æ€§**
- [ ] è³‡æ–™åº« Migration å‘å¾Œç›¸å®¹æ¸¬è©¦é€šé
- [ ] API å‘å¾Œç›¸å®¹æ¸¬è©¦é€šé
- [ ] Slack Bot å‘å¾Œç›¸å®¹æ¸¬è©¦é€šé
- [ ] Queue Worker å‘å¾Œç›¸å®¹æ¸¬è©¦é€šé
- [ ] ç«¯åˆ°ç«¯å‘å¾Œç›¸å®¹æ¸¬è©¦é€šé

**æ€§èƒ½**
- [ ] æ‰€æœ‰æ€§èƒ½åŸºæº–æ¸¬è©¦é€šé
- [ ] è³‡æ–™åº«æŸ¥è©¢æ€§èƒ½ç„¡ä¸‹é™
- [ ] API å›æ‡‰æ™‚é–“ç„¡æ˜é¡¯å¢åŠ 
- [ ] Queue è™•ç†æ™‚é–“ç„¡æ˜é¡¯å¢åŠ 

**æ–‡æª”**
- [ ] API æ–‡æª”æ›´æ–°
- [ ] éƒ¨ç½²æ–‡æª”æ›´æ–°
- [ ] ç’°å¢ƒè®Šæ•¸æ–‡æª”æ›´æ–°
- [ ] å›æ»¾è¨ˆç•«æ–‡æª”å®Œæˆ

**ç’°å¢ƒæº–å‚™**
- [ ] é–‹ç™¼ç’°å¢ƒæ¸¬è©¦é€šé
- [ ] Staging ç’°å¢ƒæ¸¬è©¦é€šé
- [ ] è³‡æ–™å‚™ä»½å®Œæˆ
- [ ] å›æ»¾è…³æœ¬æº–å‚™å®Œæˆ

---

## åˆ†éšæ®µéƒ¨ç½²è¨ˆç•« (å«é©—æ”¶)

### éšæ®µ 1: åŸºç¤è¨­æ–½éƒ¨ç½²

**éƒ¨ç½²å…§å®¹**:
- Migration (æ–°å¢ `product_line` æ¬„ä½)
- Shared package (ProductLineConfig)

**éƒ¨ç½²æ­¥é©Ÿ**:
```bash
# 1. å‚™ä»½è³‡æ–™åº«
pg_dump $DATABASE_URL > backup_$(date +%Y%m%d).sql

# 2. åŸ·è¡Œ Migration
bun run db:migrate

# 3. é©—è­‰
psql $DATABASE_URL -c "SELECT COUNT(*), product_line FROM conversations GROUP BY product_line;"
```

**é©—æ”¶æ¨™æº–**:
- âœ… Migration åŸ·è¡ŒæˆåŠŸ
- âœ… æ‰€æœ‰ç¾æœ‰è³‡æ–™ `product_line = 'ichef'`
- âœ… Index å»ºç«‹æˆåŠŸ
- âœ… ç¾æœ‰ API ç¹¼çºŒæ­£å¸¸é‹ä½œ

**å›æ»¾æ¢ä»¶**: å¦‚æœé©—æ”¶å¤±æ•—,åŸ·è¡Œå›æ»¾
```bash
# å›æ»¾ Migration (ç·Šæ€¥æƒ…æ³)
psql $DATABASE_URL < rollback_0003.sql
```

---

### éšæ®µ 2: å¾Œç«¯æœå‹™éƒ¨ç½²

**éƒ¨ç½²å…§å®¹**:
- API Router æ›´æ–°
- Queue Worker æ›´æ–°
- Orchestrator æ›´æ–°
- Prompts é‡çµ„

**éƒ¨ç½²æ­¥é©Ÿ**:
```bash
# 1. éƒ¨ç½² API
cd apps/server && wrangler deploy

# 2. éƒ¨ç½² Queue Worker
cd apps/queue-worker && wrangler deploy

# 3. ç·¨è­¯ Prompts
bun run /packages/services/scripts/build-prompts.ts
```

**é©—æ”¶æ¨™æº–**:
- âœ… API éƒ¨ç½²æˆåŠŸ
- âœ… Queue Worker éƒ¨ç½²æˆåŠŸ
- âœ… å›æ­¸æ¸¬è©¦é€šé (iCHEF æµç¨‹)
- âœ… æ€§èƒ½æ¸¬è©¦é€šé

**ç›£æ§ (éƒ¨ç½²å¾Œ 24 å°æ™‚)**:
```bash
# ç›£æ§éŒ¯èª¤ç‡
wrangler tail apps/server | grep ERROR

# ç›£æ§å›æ‡‰æ™‚é–“
# (ä½¿ç”¨ APM å·¥å…·æˆ– logs åˆ†æ)
```

**å›æ»¾æ¢ä»¶**:
- éŒ¯èª¤ç‡å¢åŠ  > 5%
- å›æ‡‰æ™‚é–“å¢åŠ  > 20%
- ä½¿ç”¨è€…å›å ±å•é¡Œ

---

### éšæ®µ 3: Slack Bot éƒ¨ç½² (ä¸å•Ÿç”¨ Beauty)

**éƒ¨ç½²å…§å®¹**:
- Slack Bot æ›´æ–°
- **ä¸è¨­å®š** `PRODUCT_LINE_CHANNELS` ç’°å¢ƒè®Šæ•¸

**éƒ¨ç½²æ­¥é©Ÿ**:
```bash
# 1. éƒ¨ç½² Slack Bot
cd apps/slack-bot && wrangler deploy

# 2. é©—è­‰ç’°å¢ƒè®Šæ•¸æœªè¨­å®š
wrangler secret list | grep PRODUCT_LINE_CHANNELS
# æ‡‰è©²æ²’æœ‰è¼¸å‡º

# 3. æ¸¬è©¦
# åœ¨ç¾æœ‰ Channel ä¸Šå‚³æ¸¬è©¦éŸ³æª”
```

**é©—æ”¶æ¨™æº–**:
- âœ… Slack Bot éƒ¨ç½²æˆåŠŸ
- âœ… ç¾æœ‰ Channel è¡Œç‚ºä¸è®Š
- âœ… è¡¨å–®èˆ‡ä¹‹å‰ç›¸åŒ
- âœ… product_line = 'ichef'

**ç›£æ§ (éƒ¨ç½²å¾Œ 24 å°æ™‚)**:
- ä½¿ç”¨è€…å›å ±ç„¡ç•°å¸¸
- Slack é€šçŸ¥æ­£å¸¸
- éŸ³æª”ä¸Šå‚³æ­£å¸¸

---

### éšæ®µ 4: å•Ÿç”¨ç¾æ¥­åŠŸèƒ½

**éƒ¨ç½²å…§å®¹**:
- è¨­å®š `PRODUCT_LINE_CHANNELS` (åªåŒ…å«æ–°çš„ Beauty Channel)
- å‰ç«¯ Dashboard æ›´æ–°
- ç¾æ¥­è©±è¡“è³‡æ–™

**éƒ¨ç½²æ­¥é©Ÿ**:
```bash
# 1. å»ºç«‹æ–°çš„ Beauty Channel (åœ¨ Slack ä¸­)
# è¨˜éŒ„ Channel ID: C06789XXXXX

# 2. è¨­å®šç’°å¢ƒè®Šæ•¸
wrangler secret put PRODUCT_LINE_CHANNELS
# è¼¸å…¥: {"C12345ICHEF":"ichef","C06789XXXXX":"beauty"}

# 3. éƒ¨ç½² Dashboard
cd apps/web && npm run build && npm run deploy

# 4. Seed ç¾æ¥­è©±è¡“
bun run scripts/seed-beauty-talk-tracks.ts
```

**é©—æ”¶æ¨™æº–**:
- âœ… ç’°å¢ƒè®Šæ•¸è¨­å®šæˆåŠŸ
- âœ… Beauty Channel ä½¿ç”¨ç¾æ¥­è¡¨å–®
- âœ… iCHEF Channel ä¸å—å½±éŸ¿
- âœ… Dashboard éæ¿¾åŠŸèƒ½æ­£å¸¸
- âœ… ç¾æ¥­è©±è¡“è³‡æ–™å®Œæ•´

**ç›£æ§ (éƒ¨ç½²å¾Œ 1 é€±)**:
- Beauty Channel ä½¿ç”¨ç‹€æ³
- ç¾æ¥­åˆ†æå“è³ª
- ä½¿ç”¨è€…åé¥‹
- éŒ¯èª¤ç‡

---

## é©—æ”¶å¤±æ•—è™•ç†æµç¨‹

### å¦‚æœæŸå€‹é©—æ”¶æª¢æŸ¥é»å¤±æ•—

```
ç™¼ç¾å•é¡Œ
    â†“
åœæ­¢é€²å…¥ä¸‹ä¸€éšæ®µ
    â†“
åˆ†æå•é¡Œæ ¹å› 
    â†“
ä¿®å¾©å•é¡Œ
    â†“
é‡æ–°åŸ·è¡Œè©²æª¢æŸ¥é»çš„æ‰€æœ‰æ¸¬è©¦
    â†“
é€šé â†’ ç¹¼çºŒ
å¤±æ•— â†’ é‡è¤‡ä¿®å¾©
```

### ç·Šæ€¥å›æ»¾æ±ºç­–æ¨¹

```
ç”Ÿç”¢ç’°å¢ƒå‡ºç¾å•é¡Œ?
    â”œâ”€ å½±éŸ¿ < 5% ä½¿ç”¨è€… â†’ ç›£æ§ + å¿«é€Ÿä¿®å¾©
    â”œâ”€ å½±éŸ¿ 5-20% ä½¿ç”¨è€… â†’ éƒ¨åˆ†å›æ»¾ (Slack Bot/API)
    â””â”€ å½±éŸ¿ > 20% ä½¿ç”¨è€… â†’ å…¨é¢å›æ»¾
```

---

## ç¸½çµ

### ğŸ¯ æˆåŠŸæ¨™æº–

**å¿…é ˆæ»¿è¶³æ‰€æœ‰æ¢ä»¶**:
1. âœ… æ‰€æœ‰é©—æ”¶æª¢æŸ¥é»é€šé
2. âœ… æ‰€æœ‰å›æ­¸æ¸¬è©¦é€šé
3. âœ… æ‰€æœ‰æ€§èƒ½åŸºæº–é€šé
4. âœ… éƒ¨ç½²å‰æœ€çµ‚æª¢æŸ¥æ¸…å–®å®Œæˆ
5. âœ… åˆ†éšæ®µéƒ¨ç½²æ¯éšæ®µé©—æ”¶é€šé

### ğŸ“Š é—œéµæŒ‡æ¨™

**é–‹ç™¼æœŸé–“**:
- æ¸¬è©¦è¦†è“‹ç‡ > 80%
- TypeScript ç·¨è­¯ 0 éŒ¯èª¤
- Linting 0 è­¦å‘Š

**éƒ¨ç½²å¾Œç›£æ§**:
- éŒ¯èª¤ç‡å¢åŠ  < 5%
- API å›æ‡‰æ™‚é–“å¢åŠ  < 10%
- Queue è™•ç†æ™‚é–“å¢åŠ  < 10%
- ä½¿ç”¨è€…æ»¿æ„åº¦ç¶­æŒæˆ–æå‡

### ğŸš€ æº–å‚™å¥½éƒ¨ç½²çš„æ¢ä»¶

ç•¶ä»¥ä¸‹æ‰€æœ‰æ¢ä»¶éƒ½æ»¿è¶³æ™‚,**æ‰èƒ½**é€²å…¥ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²:

- âœ… Agent A-E å…¨éƒ¨å®Œæˆä¸¦é€šéé©—æ”¶
- âœ… æ•´åˆæ¸¬è©¦å…¨éƒ¨é€šé
- âœ… å›æ­¸æ¸¬è©¦å…¨éƒ¨é€šé
- âœ… æ€§èƒ½æ¸¬è©¦å…¨éƒ¨é€šé
- âœ… éƒ¨ç½²å‰æª¢æŸ¥æ¸…å–®å…¨éƒ¨å®Œæˆ
- âœ… å›æ»¾è¨ˆç•«å·²æº–å‚™
- âœ… åœ˜éšŠæˆå“¡å·²åŸ¹è¨“

**åªæœ‰åœ¨æ‰€æœ‰æ¢ä»¶éƒ½æ˜¯ç¶ ç‡ˆæ™‚,æ‰é–‹å§‹éƒ¨ç½²!**
