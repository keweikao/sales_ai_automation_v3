---
name: opportunity
description: 快速查詢特定機會的完整資訊。輸入客戶編號（如 201700-000001）或公司名稱即可查看機會狀態、歷史互動、待辦事項等。
---

# /opportunity - 機會快速查詢

## 描述
快速查詢特定機會的完整資訊，包括基本資料、歷史對話、MEDDIC 分析、待辦事項等。

## 使用方式
```
/opportunity 201700-000001     # 客戶編號查詢
/opportunity 王記咖啡          # 公司名稱查詢
/opportunity --recent          # 最近 10 筆機會
/opportunity --stage 報價中    # 依階段篩選
```

## 執行流程

### 步驟 1: 解析查詢參數

根據輸入判斷查詢方式：

| 輸入格式 | 查詢方式 |
|----------|----------|
| `YYYYMM-######` | 客戶編號精確查詢 |
| 中文/英文字串 | 公司名稱模糊查詢 |
| `--recent` | 最近建立的機會 |
| `--stage [階段]` | 依銷售階段篩選 |

### 步驟 2: 查詢資料庫

**使用 API 或直接查詢：**

```typescript
// 透過 API
const result = await client.opportunity.get({ customerNumber: "201700-000001" });

// 或透過資料庫
const opportunity = await db.query.opportunities.findFirst({
  where: eq(opportunities.customerNumber, customerNumber),
  with: {
    conversations: true,
    todos: true,
  },
});
```

**查詢欄位：**
- 基本資料：公司名稱、客戶編號、聯絡人、電話
- 銷售資訊：階段、預計金額、預計成交日
- 關聯資料：對話記錄、MEDDIC 分析、待辦事項

### 步驟 3: 查詢關聯的 MEDDIC 分析

```sql
SELECT
  c.case_number,
  m.overall_score,
  m.metrics_score,
  m.economic_buyer_score,
  m.decision_criteria_score,
  m.decision_process_score,
  m.identify_pain_score,
  m.champion_score,
  m.created_at
FROM conversations c
JOIN meddic_analyses m ON c.id = m.conversation_id
WHERE c.opportunity_id = ?
ORDER BY m.created_at DESC
LIMIT 5;
```

### 步驟 4: 查詢待辦事項

```sql
SELECT
  id, title, status, due_date, postpone_history
FROM sales_todos
WHERE opportunity_id = ?
ORDER BY due_date ASC;
```

### 步驟 5: 輸出報告

---

## 輸出格式

### 找到機會

```markdown
## 機會查詢結果

══════════════════════════════════════════════════
🏢 公司名稱: 王記咖啡
🔖 客戶編號: 201700-000001
══════════════════════════════════════════════════

### 基本資料
| 欄位 | 內容 |
|------|------|
| 聯絡人 | 王大明 |
| 電話 | 0912-345-678 |
| 地址 | 台北市信義區... |
| 業務 | 李小華 |

### 銷售狀態
| 欄位 | 內容 |
|------|------|
| 階段 | 📊 報價中 |
| 預計金額 | NT$ 150,000 |
| 預計成交 | 2026/02/15 |
| 建立日期 | 2026/01/15 |

### 最近 MEDDIC 分析
| 案件 | 日期 | 總分 | M | E | D | D | I | C |
|------|------|------|---|---|---|---|---|---|
| IC918 | 01/27 | 74 | 80 | 70 | 75 | 72 | 68 | 79 |
| IC915 | 01/25 | 68 | 75 | 65 | 70 | 68 | 62 | 68 |

### 待辦事項
| 狀態 | 標題 | 到期日 | 改期 |
|------|------|--------|------|
| ⏳ | 回電確認報價 | 01/28 | 0次 |
| ✅ | 寄送報價單 | 01/26 | - |
| ✅ | 初次拜訪 | 01/20 | 1次 |

### 對話記錄 (最近 5 筆)
| 案件編號 | 日期 | 狀態 | 時長 |
|----------|------|------|------|
| IC918 | 01/27 | ✅ 完成 | 12:35 |
| IC915 | 01/25 | ✅ 完成 | 8:20 |
| IC910 | 01/22 | ✅ 完成 | 15:45 |
```

### 找不到機會

```markdown
❌ 找不到機會: 王記咖啡

可能原因:
  1. 公司名稱輸入錯誤
  2. 該客戶尚未建立機會

📋 相似的公司名稱:
  - 201700-000123: 王記餐廳
  - 201700-000456: 王家咖啡廳
  - 201700-000789: 老王咖啡
```

### 最近機會列表 (--recent)

```markdown
## 最近機會列表
📅 更新時間: 2026-01-27 15:30

| 客戶編號 | 公司名稱 | 階段 | 預計金額 | 業務 |
|----------|----------|------|----------|------|
| 201700-000001 | 王記咖啡 | 報價中 | 150K | 李小華 |
| 201700-000002 | 張氏火鍋 | 需求確認 | 80K | 王大明 |
| 201700-000003 | 陳家小吃 | 初步接洽 | 50K | 李小華 |
| ... | ... | ... | ... | ... |
```

---

## 銷售階段說明

| 階段 | 說明 |
|------|------|
| 初步接洽 | 首次聯繫，了解需求 |
| 需求確認 | 深入了解客戶需求 |
| 報價中 | 已提供報價方案 |
| 議價中 | 價格協商階段 |
| 成交 | 已簽約成交 |
| 流失 | 客戶選擇競品或放棄 |

---

## 整合的工具

| 工具 | 用途 |
|------|------|
| `Bash` | 執行查詢腳本 |
| `Read` / `Grep` | 搜尋相關代碼 |

## 相關頁面

- Web: `/opportunities` - 機會列表頁面
- Web: `/opportunities/:id` - 機會詳情頁面

## 注意事項

1. **客戶編號格式** - 格式為 `YYYYMM-######`（如 201700-000001）
2. **模糊查詢** - 公司名稱支援部分匹配
3. **權限** - 一般業務只能查詢自己的機會，主管可查詢部門內所有機會
